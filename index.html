<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Профиль - Форма регистрации</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            display: flex;
            gap: 24px;
            width: 100%;
            max-width: 1100px;
        }

        .sidebar {
            background: #0f1629;
            border: 1px solid #1e293b;
            border-radius: 24px;
            padding: 32px 0;
            width: 280px;
            flex-shrink: 0;
        }

        .sidebar-header {
            padding: 0 24px 24px;
            border-bottom: 1px solid #1e293b;
        }

        .sidebar-title {
            color: #f1f5f9;
            font-size: 20px;
            font-weight: 700;
        }

        .sidebar-nav {
            padding: 16px 0;
        }

        .nav-item.hidden {
            display: none;
        }
        
        .nav-item {
            position: relative;
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 24px;
            color: #94a3b8;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }

        .nav-item:hover {
            background: rgba(59, 130, 246, 0.05);
            color: #e2e8f0;
        }

        .nav-item.active {
            background: rgba(59, 130, 246, 0.1);
            color: #3b82f6;
            border-left-color: #3b82f6;
        }

        .nav-icon {
            width: 20px;
            height: 20px;
            stroke: currentColor;
            stroke-width: 2;
            fill: none;
        }

        .card {
            background: #0f1629;
            border: 1px solid #1e293b;
            border-radius: 24px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            flex: 1;
            padding: 48px;
            overflow-y: auto;
            max-height: calc(100vh - 40px);
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .icon-wrapper {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 64px;
            height: 64px;
            background: rgba(59, 130, 246, 0.1);
            border-radius: 16px;
            margin-bottom: 16px;
        }

        .user-icon {
            width: 32px;
            height: 32px;
            stroke: #3b82f6;
            stroke-width: 2;
            fill: none;
        }

        h1 {
            color: #f1f5f9;
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
            letter-spacing: -0.5px;
        }

        .subtitle {
            color: #64748b;
            font-size: 14px;
        }

        .photo-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 16px;
            margin-bottom: 32px;
        }

        .photo-wrapper {
            position: relative;
        }

        .photo-preview {
            width: 96px;
            height: 96px;
            border-radius: 50%;
            background: #1e293b;
            border: 2px solid #334155;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .photo-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .photo-preview svg {
            width: 40px;
            height: 40px;
            stroke: #64748b;
            stroke-width: 2;
            fill: none;
        }

        .upload-button {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: #3b82f6;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.2s;
            z-index: 10;
        }

        .upload-button:hover {
            background: #2563eb;
        }

        .upload-button svg {
            width: 18px;
            height: 18px;
            stroke: white;
            stroke-width: 2;
            fill: none;
        }

        #photoInput {
            display: none;
        }

        .photo-hint {
            font-size: 12px;
            color: #64748b;
        }

        .form-group {
            margin-bottom: 24px;
        }

        label {
            display: block;
            color: #f1f5f9;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .input-wrapper {
            position: relative;
        }

        .input-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            width: 16px;
            height: 16px;
            stroke: #64748b;
            stroke-width: 2;
            fill: none;
            pointer-events: none;
        }

        input {
            width: 100%;
            height: 44px;
            padding-left: 40px;
            padding-right: 16px;
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid #334155;
            border-radius: 12px;
            color: #f1f5f9;
            font-size: 14px;
            transition: all 0.2s;
        }

        input::placeholder {
            color: #475569;
        }

        input:focus {
            outline: none;
            border-color: #3b82f6;
            background: rgba(30, 41, 59, 0.8);
        }

        .submit-button {
            width: 100%;
            height: 44px;
            background: #3b82f6;
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
            margin-top: 8px;
        }

        .submit-button:hover {
            background: #2563eb;
        }

        .footer {
            margin-top: 24px;
            text-align: center;
        }

        .footer-text {
            font-size: 12px;
            color: #64748b;
            line-height: 1.5;
        }

        .empty-content {
            text-align: center;
            padding: 60px 20px;
        }

        .empty-icon {
            width: 64px;
            height: 64px;
            margin: 0 auto 24px;
            stroke: #475569;
            stroke-width: 2;
            fill: none;
        }

        .empty-title {
            color: #f1f5f9;
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .empty-description {
            color: #64748b;
            font-size: 14px;
            line-height: 1.6;
        }

        .charity-buttons {
            display: flex;
            gap: 16px;
            margin-bottom: 32px;
            justify-content: center;
        }

        .charity-button {
            flex: 1;
            max-width: 240px;
            height: 120px;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(37, 99, 235, 0.05) 100%);
            border: 2px solid #334155;
            border-radius: 16px;
            color: #f1f5f9;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        .charity-button:hover {
            border-color: #3b82f6;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2) 0%, rgba(37, 99, 235, 0.1) 100%);
            transform: translateY(-2px);
        }

        .charity-button svg {
            width: 32px;
            height: 32px;
            stroke: #3b82f6;
            stroke-width: 2;
            fill: none;
        }

        .intro-form {
            background: rgba(30, 41, 59, 0.3);
            border: 1px solid #334155;
            border-radius: 16px;
            padding: 32px;
            max-width: 500px;
            margin: 0 auto;
        }

        .intro-form h2 {
            color: #f1f5f9;
            font-size: 20px;
            margin-bottom: 8px;
        }

        .intro-form p {
            color: #64748b;
            font-size: 14px;
            margin-bottom: 24px;
        }

        .payment-details-button {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px 32px;
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .payment-details-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
        }

        .payment-details-button:active {
            transform: translateY(0);
        }

        .payment-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(10, 14, 39, 0.95);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
            overflow-y: auto;
        }

        .payment-modal.active {
            display: flex;
        }

        .payment-modal-content {
            background: #0f1629;
            border: 1px solid #1e293b;
            border-radius: 24px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            padding: 40px;
        }

        .payment-modal-close {
            position: absolute;
            top: 16px;
            right: 16px;
            width: 40px;
            height: 40px;
            background: rgba(30, 41, 59, 0.5);
            border: none;
            border-radius: 50%;
            color: #f1f5f9;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .payment-modal-close:hover {
            background: rgba(30, 41, 59, 0.8);
            transform: rotate(90deg);
        }

        .payment-modal-close svg {
            width: 20px;
            height: 20px;
            stroke: currentColor;
            stroke-width: 2;
        }

        .submit-receipt-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
        }

        .submit-receipt-button:active {
            transform: translateY(0);
        }

        .submit-receipt-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        #receiptUploadArea:hover {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.05);
        }

        .receipt-processing-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(10, 14, 39, 0.95);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            padding: 20px;
        }

        .receipt-processing-modal.active {
            display: flex;
        }

        .receipt-processing-content {
            background: #0f1629;
            border: 1px solid #1e293b;
            border-radius: 24px;
            max-width: 500px;
            width: 100%;
            padding: 48px;
            text-align: center;
        }

        .posts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .post-card {
            background: rgba(30, 41, 59, 0.4);
            border: 1px solid #334155;
            border-radius: 16px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        
        .post-id {
            position: absolute;
            top: 12px;
            right: 12px;
            color: #64748b;
            font-size: 11px;
            font-weight: 600;
            background: rgba(15, 22, 41, 0.8);
            padding: 4px 8px;
            border-radius: 6px;
            border: 1px solid rgba(59, 130, 246, 0.2);
            font-family: 'Courier New', monospace;
            letter-spacing: 0.5px;
            z-index: 5;
        }

        .post-card:hover {
            border-color: #3b82f6;
            transform: translateY(-4px);
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.2);
        }

        .post-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
        }

        .post-content {
            padding: 16px;
        }

        .post-author {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .post-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #334155;
        }

        .post-author-info {
            flex: 1;
        }

        .post-author-name {
            color: #f1f5f9;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .post-title {
            color: #f1f5f9;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .post-amount {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.15) 0%, rgba(139, 92, 246, 0.15) 100%);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-left: 3px solid #3b82f6;
            border-radius: 8px;
            padding: 10px 16px;
            margin-top: 8px;
            position: relative;
            overflow: hidden;
        }
        
        .post-amount::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: var(--progress-width, 0%);
            background: linear-gradient(90deg, rgba(59, 130, 246, 0.3) 0%, rgba(139, 92, 246, 0.3) 100%);
            transition: width 0.3s ease;
            z-index: 0;
        }
        
        .post-amount-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            position: relative;
            z-index: 1;
        }
        
        .post-amount-collected {
            color: #10b981;
            font-size: 16px;
            font-weight: 700;
        }
        
        .post-amount-separator {
            color: #64748b;
            font-size: 14px;
            margin: 0 8px;
        }
        
        .post-amount-target {
            color: #3b82f6;
            font-size: 16px;
            font-weight: 700;
        }
        
        .post-amount-currency {
            color: #8b5cf6;
            font-size: 14px;
            margin-left: 4px;
        }

        .post-detail {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(10, 14, 39, 0.95);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
            overflow-y: auto;
        }

        .post-detail.active {
            display: flex;
        }

        .post-detail-content {
            background: #0f1629;
            border: 1px solid #1e293b;
            border-radius: 24px;
            max-width: 700px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }
        
        .detail-post-id {
            position: absolute;
            top: 16px;
            right: 16px;
            color: #64748b;
            font-size: 12px;
            font-weight: 600;
            background: rgba(15, 22, 41, 0.9);
            padding: 6px 12px;
            border-radius: 8px;
            border: 1px solid rgba(59, 130, 246, 0.3);
            font-family: 'Courier New', monospace;
            letter-spacing: 0.5px;
            z-index: 10;
        }

        .post-detail-header {
            position: relative;
            height: 400px;
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
        }

        .post-detail-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .close-button {
            position: absolute;
            top: 16px;
            right: 16px;
            width: 40px;
            height: 40px;
            background: rgba(15, 22, 41, 0.9);
            border: 1px solid #334155;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .close-button:hover {
            background: rgba(15, 22, 41, 1);
            border-color: #3b82f6;
        }

        .close-button svg {
            width: 20px;
            height: 20px;
            stroke: #f1f5f9;
            stroke-width: 2;
            fill: none;
        }

        .post-detail-body {
            padding: 32px;
        }

        .detail-author {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 24px;
            padding-bottom: 24px;
            border-bottom: 1px solid #1e293b;
        }

        .detail-avatar {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #334155;
        }

        .detail-author-info h3 {
            color: #f1f5f9;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .detail-author-info p {
            color: #64748b;
            font-size: 13px;
        }

        .post-detail-title {
            color: #f1f5f9;
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 16px;
            line-height: 1.3;
        }

        .post-detail-description {
            color: #94a3b8;
            font-size: 14px;
            line-height: 1.7;
            margin-bottom: 24px;
            white-space: pre-wrap;
        }

        .post-detail-info {
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid #334155;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            gap: 16px;
        }
        
        .info-row .amount-display {
            flex: 1;
            min-width: 200px;
        }

        .info-row:last-child {
            margin-bottom: 0;
        }

        .info-label {
            color: #64748b;
            font-size: 14px;
        }

        .info-value {
            color: #f1f5f9;
            font-size: 14px;
            font-weight: 600;
        }

        .amount-display {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2) 0%, rgba(139, 92, 246, 0.2) 100%);
            border: 2px solid rgba(59, 130, 246, 0.4);
            border-left: 4px solid #3b82f6;
            border-radius: 12px;
            padding: 16px 24px;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
            position: relative;
            overflow: hidden;
        }
        
        .amount-display::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: var(--progress-width, 0%);
            background: linear-gradient(90deg, rgba(59, 130, 246, 0.4) 0%, rgba(139, 92, 246, 0.4) 100%);
            transition: width 0.3s ease;
            z-index: 0;
        }
        
        .amount-display-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            position: relative;
            z-index: 1;
        }
        
        .amount-display-collected {
            color: #10b981;
            font-size: 24px;
            font-weight: 700;
        }
        
        .amount-display-separator {
            color: #64748b;
            font-size: 20px;
            margin: 0 12px;
        }
        
        .amount-display-target {
            color: #3b82f6;
            font-size: 24px;
            font-weight: 700;
        }
        
        .amount-display-currency {
            color: #8b5cf6;
            font-size: 20px;
            margin-left: 6px;
        }
        
        .user-post-amount-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.15) 0%, rgba(139, 92, 246, 0.15) 100%);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-left: 3px solid #3b82f6;
            border-radius: 8px;
            padding: 6px 14px;
            color: #3b82f6;
            font-size: 15px;
            font-weight: 700;
        }
        
        .user-post-amount-badge::before {
            content: 'Цель: ';
            color: #64748b;
            font-weight: 500;
            font-size: 13px;
        }
        
        .user-post-amount-badge::after {
            content: ' ₽';
            color: #8b5cf6;
            font-size: 14px;
            margin-left: 2px;
        }


        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: #64748b;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            margin-bottom: 24px;
            transition: color 0.2s;
        }

        .back-button:hover {
            color: #3b82f6;
        }

        .back-button svg {
            width: 16px;
            height: 16px;
            stroke: currentColor;
            stroke-width: 2;
            fill: none;
        }


        .chats-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .chat-item {
            position: relative;
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            background: rgba(30, 41, 59, 0.3);
            border: 1px solid #334155;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 12px;
        }

        .chat-item:hover {
            background: rgba(30, 41, 59, 0.5);
            border-color: #3b82f6;
        }

        .chat-item-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #334155;
        }

        .chat-item-info {
            flex: 1;
        }

        .chat-item-name {
            color: #f1f5f9;
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .chat-item-last-message {
            color: #64748b;
            font-size: 13px;
        }

        .chat-item-notification {
            position: absolute;
            top: 16px;
            right: 16px;
            width: 12px;
            height: 12px;
            background: #10b981;
            border-radius: 50%;
            border: 2px solid #0f1629;
        }

        .chat-date-separator {
            text-align: center;
            margin: 16px 0;
            position: relative;
        }

        .chat-date-separator::before,
        .chat-date-separator::after {
            content: '';
            position: absolute;
            top: 50%;
            width: 35%;
            height: 1px;
            background: #334155;
        }

        .chat-date-separator::before {
            left: 0;
        }

        .chat-date-separator::after {
            right: 0;
        }

        .chat-date-text {
            display: inline-block;
            padding: 4px 12px;
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid #334155;
            border-radius: 12px;
            color: #64748b;
            font-size: 12px;
        }

        .message-actions {
            display: none;
            gap: 8px;
            margin-top: 4px;
        }

        .chat-message:hover .message-actions {
            display: flex;
        }

        .message-edit-btn {
            background: transparent;
            border: none;
            color: #64748b;
            font-size: 11px;
            cursor: pointer;
            padding: 2px 8px;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .message-edit-btn:hover {
            color: #3b82f6;
            background: rgba(59, 130, 246, 0.1);
        }


        .chat-container {
            display: none;
            flex-direction: column;
            height: 100%;
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 380px;
            background: #0f1629;
            border: 1px solid #1e293b;
            border-radius: 16px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            z-index: 2000;
        }

        .chat-container.active {
            display: flex;
        }

        .chat-container-fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            height: 100%;
            border-radius: 0;
            z-index: 3000;
        }

        .chat-header {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            border-bottom: 1px solid #1e293b;
        }

        .chat-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #334155;
        }

        .chat-header-info {
            flex: 1;
        }

        .chat-header-name {
            color: #f1f5f9;
            font-size: 14px;
            font-weight: 600;
        }

        .chat-header-status {
            color: #64748b;
            font-size: 12px;
        }

        .chat-close {
            width: 32px;
            height: 32px;
            background: transparent;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            transition: background 0.2s;
        }

        .chat-close:hover {
            background: rgba(59, 130, 246, 0.1);
        }

        .chat-close svg {
            width: 20px;
            height: 20px;
            stroke: #64748b;
            stroke-width: 2;
            fill: none;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .chat-message {
            display: flex;
            gap: 8px;
            max-width: 80%;
        }

        .chat-message.own {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            object-fit: cover;
            flex-shrink: 0;
        }

        .message-bubble {
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid #334155;
            border-radius: 12px;
            padding: 10px 14px;
        }

        .chat-message.own .message-bubble {
            background: rgba(59, 130, 246, 0.2);
            border-color: #3b82f6;
        }

        .message-text {
            color: #f1f5f9;
            font-size: 14px;
            line-height: 1.5;
            word-wrap: break-word;
        }

        .message-time {
            color: #64748b;
            font-size: 11px;
            margin-top: 4px;
        }

        .message-attachment {
            max-width: 100%;
            border-radius: 8px;
            margin-top: 8px;
        }

        .chat-input-area {
            padding: 16px;
            border-top: 1px solid #1e293b;
        }

        .emoji-picker {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }

        .emoji-btn {
            width: 32px;
            height: 32px;
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid #334155;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .emoji-btn:hover {
            background: rgba(59, 130, 246, 0.2);
            border-color: #3b82f6;
            transform: scale(1.1);
        }

        .chat-input-wrapper {
            display: flex;
            gap: 8px;
        }

        .chat-input {
            flex: 1;
            height: 40px;
            padding: 0 12px;
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid #334155;
            border-radius: 12px;
            color: #f1f5f9;
            font-size: 14px;
        }

        .chat-input:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .chat-attach-btn {
            width: 40px;
            height: 40px;
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid #334155;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .chat-attach-btn:hover {
            background: rgba(59, 130, 246, 0.2);
            border-color: #3b82f6;
        }

        .chat-attach-btn svg {
            width: 20px;
            height: 20px;
            stroke: #64748b;
            stroke-width: 2;
            fill: none;
        }

        .chat-send-btn {
            width: 40px;
            height: 40px;
            background: #3b82f6;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .chat-send-btn:hover {
            background: #2563eb;
        }

        .chat-send-btn svg {
            width: 20px;
            height: 20px;
            stroke: white;
            stroke-width: 2;
            fill: none;
        }

        .chat-button {
            width: 100%;
            height: 44px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 16px;
            display: none;
        }

        .chat-button.active {
            display: block;
        }

        .chat-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(16, 185, 129, 0.4);
        }

        .notification-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 10px;
            height: 10px;
            background: #10b981;
            border-radius: 50%;
            border: 2px solid #0f1629;
        }

        .chat-container {
            display: none;
            flex-direction: column;
            height: 100%;
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 380px;
            background: #0f1629;
            border: 1px solid #1e293b;
            border-radius: 16px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            z-index: 2000;
        }

        .chat-container.active {
            display: flex;
        }

        .chat-container-fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            height: 100%;
            border-radius: 0;
            z-index: 3000;
        }

        .chat-back-btn {
            width: 32px;
            height: 32px;
            background: transparent;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            transition: background 0.2s;
            margin-right: 8px;
        }

        .chat-back-btn:hover {
            background: rgba(59, 130, 246, 0.1);
        }

        .chat-back-btn svg {
            width: 20px;
            height: 20px;
            stroke: #64748b;
            stroke-width: 2;
            fill: none;
        }

        .chats-list-view {
            display: block;
        }

        .chats-list-view.hidden {
            display: none;
        }

        .rating-container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .info-box {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(139, 92, 246, 0.1));
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 32px;
        }

        .info-box h3 {
            color: #f1f5f9;
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .info-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
        }

        .status-info {
            background: rgba(30, 41, 59, 0.4);
            padding: 16px;
            border-radius: 12px;
            border: 1px solid rgba(51, 65, 85, 0.5);
        }

        .status-name {
            color: #3b82f6;
            font-weight: 600;
            font-style: italic;
            font-size: 15px;
            margin-bottom: 4px;
        }

        .status-points {
            color: #94a3b8;
            font-size: 13px;
        }

        .user-rating-card {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.15), rgba(139, 92, 246, 0.15));
            border: 2px solid rgba(59, 130, 246, 0.4);
            border-radius: 20px;
            padding: 32px;
            margin-bottom: 32px;
            display: flex;
            align-items: center;
            gap: 24px;
            box-shadow: 0 8px 32px rgba(59, 130, 246, 0.2);
        }

        .user-rating-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: rgba(30, 41, 59, 0.5);
            border: 3px solid #3b82f6;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            flex-shrink: 0;
        }

        .user-rating-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .user-rating-info {
            flex: 1;
        }

        .user-rating-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
        }

        .user-rating-name {
            font-size: 28px;
            font-weight: 700;
            color: #f1f5f9;
        }

        .rank-badge {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .rank-1 {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #7c2d12;
        }

        .rank-2 {
            background: linear-gradient(135deg, #c0c0c0, #e8e8e8);
            color: #1e293b;
        }

        .rank-3 {
            background: linear-gradient(135deg, #cd7f32, #e6a869);
            color: #431407;
        }

        .user-rating-status {
            font-style: italic;
            color: #3b82f6;
            font-size: 16px;
            margin-bottom: 12px;
        }

        .user-rating-stats {
            display: flex;
            gap: 32px;
        }

        .rating-stat {
            display: flex;
            flex-direction: column;
        }

        .rating-stat-label {
            color: #94a3b8;
            font-size: 13px;
            margin-bottom: 4px;
        }

        .rating-stat-value {
            color: #f1f5f9;
            font-size: 24px;
            font-weight: 700;
        }

        .leaderboard {
            background: rgba(30, 41, 59, 0.3);
            border: 1px solid rgba(51, 65, 85, 0.5);
            border-radius: 20px;
            padding: 24px;
        }

        .leaderboard-title {
            font-size: 20px;
            font-weight: 700;
            color: #f1f5f9;
            margin-bottom: 20px;
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            background: rgba(30, 41, 59, 0.4);
            border: 1px solid rgba(51, 65, 85, 0.5);
            border-radius: 12px;
            margin-bottom: 12px;
            transition: all 0.2s;
        }

        .leaderboard-item:hover {
            background: rgba(30, 41, 59, 0.6);
            border-color: rgba(59, 130, 246, 0.5);
        }

        .leaderboard-item.current-user {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(139, 92, 246, 0.2));
            border: 2px solid rgba(59, 130, 246, 0.6);
            box-shadow: 0 4px 16px rgba(59, 130, 246, 0.3);
        }

        .leaderboard-item.current-user .leaderboard-avatar {
            border-color: #3b82f6;
            box-shadow: 0 0 12px rgba(59, 130, 246, 0.5);
        }

        .leaderboard-item.current-user .leaderboard-name {
            color: #3b82f6;
            font-weight: 700;
        }

        .leaderboard-position {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 16px;
            color: #64748b;
            flex-shrink: 0;
        }

        .leaderboard-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: rgba(59, 130, 246, 0.2);
            border: 2px solid rgba(59, 130, 246, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            flex-shrink: 0;
        }

        .leaderboard-avatar svg {
            width: 24px;
            height: 24px;
            stroke: #64748b;
        }

        .leaderboard-info {
            flex: 1;
        }

        .leaderboard-name {
            font-weight: 600;
            color: #f1f5f9;
            font-size: 15px;
            margin-bottom: 4px;
        }

        .leaderboard-status {
            font-style: italic;
            color: #64748b;
            font-size: 13px;
        }

        .leaderboard-points {
            font-weight: 700;
            color: #3b82f6;
            font-size: 16px;
        }

        .rules-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .rules-section {
            margin-bottom: 32px;
        }

        .rules-section-title {
            font-size: 24px;
            font-weight: 700;
            color: #f1f5f9;
            margin-bottom: 20px;
            text-align: center;
        }

        .rules-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 24px;
            margin-bottom: 40px;
        }

        .rule-card {
            background: rgba(30, 41, 59, 0.4);
            border: 1px solid rgba(51, 65, 85, 0.5);
            border-radius: 20px;
            padding: 28px;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .rule-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6);
        }

        .rule-card:hover {
            transform: translateY(-4px);
            border-color: rgba(59, 130, 246, 0.5);
            box-shadow: 0 8px 32px rgba(59, 130, 246, 0.2);
        }

        .rule-card-number {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 700;
            color: white;
            margin-bottom: 16px;
        }

        .rule-card-title {
            font-size: 18px;
            font-weight: 700;
            color: #f1f5f9;
            margin-bottom: 12px;
        }

        .rule-card-description {
            color: #94a3b8;
            font-size: 14px;
            line-height: 1.6;
        }

        .platform-rules {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(139, 92, 246, 0.1));
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 20px;
            padding: 32px;
            margin-bottom: 32px;
        }

        .platform-rules h2 {
            font-size: 28px;
            font-weight: 700;
            color: #f1f5f9;
            margin-bottom: 8px;
            text-align: center;
        }

        .platform-rules-subtitle {
            color: #94a3b8;
            text-align: center;
            margin-bottom: 24px;
        }

        .platform-rule-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 16px;
            background: rgba(30, 41, 59, 0.3);
            border-radius: 12px;
            margin-bottom: 12px;
        }

        .platform-rule-icon {
            width: 24px;
            height: 24px;
            background: #3b82f6;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .platform-rule-icon svg {
            width: 14px;
            height: 14px;
            stroke: white;
            stroke-width: 3;
        }

        .platform-rule-text {
            color: #e2e8f0;
            font-size: 14px;
            line-height: 1.6;
        }

        .chat-view {
            display: none;
            flex-direction: column;
            height: 100%;
        }

        .chat-view.active {
            display: flex;
        }


        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
            }

            .sidebar-nav {
                display: flex;
                overflow-x: auto;
                padding: 8px 0;
            }

            .nav-item {
                flex-shrink: 0;
                border-left: none;
                border-bottom: 3px solid transparent;
            }

            .nav-item.active {
                border-left: none;
                border-bottom-color: #3b82f6;
            }

            .charity-buttons {
                flex-direction: column;
            }

            .charity-button {
                max-width: 100%;
            }

            .posts-grid {
                grid-template-columns: 1fr;
            }

            .post-detail-header {
                height: 300px;
            }

            .chat-container {
                width: 100%;
                height: 100%;
                bottom: 0;
                right: 0;
                border-radius: 0;
            }
        }

        @media (max-width: 480px) {
            .card {
                padding: 32px 24px;
            }

            h1 {
                font-size: 24px;
            }

            .post-detail-body {
                padding: 24px;
            }
        }

        .support-container {
            max-width: 900px;
            margin: 0 auto;
        }

        .support-categories {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .support-category {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(147, 51, 234, 0.05) 100%);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 16px;
            padding: 24px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .support-category::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.15) 0%, rgba(147, 51, 234, 0.1) 100%);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .support-category:hover {
            transform: translateY(-4px);
            border-color: #3b82f6;
            box-shadow: 0 12px 24px rgba(59, 130, 246, 0.2);
        }

        .support-category:hover::before {
            opacity: 1;
        }

        .support-category-icon {
            width: 48px;
            height: 48px;
            background: rgba(59, 130, 246, 0.1);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 16px;
            position: relative;
            z-index: 1;
        }

        .support-category-icon svg {
            width: 24px;
            height: 24px;
            stroke: #3b82f6;
        }

        .support-category h3 {
            color: #f1f5f9;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            position: relative;
            z-index: 1;
        }

        .support-category p {
            color: #94a3b8;
            font-size: 14px;
            line-height: 1.5;
            position: relative;
            z-index: 1;
        }

        .support-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(10, 14, 39, 0.95);
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .support-modal-content {
            background: linear-gradient(135deg, #0f1629 0%, #1a1f3a 100%);
            border: 1px solid #1e293b;
            border-radius: 24px;
            max-width: 600px;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
            position: relative;
            animation: slideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .support-modal-header {
            padding: 32px 32px 24px;
            border-bottom: 1px solid rgba(51, 65, 85, 0.5);
        }

        .support-modal-header h2 {
            color: #f1f5f9;
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .support-modal-header p {
            color: #64748b;
            font-size: 14px;
        }

        .support-modal-body {
            padding: 24px 32px;
        }

        .support-solution {
            background: rgba(30, 41, 59, 0.3);
            border: 1px solid #334155;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .support-solution:hover {
            background: rgba(30, 41, 59, 0.5);
            border-color: #3b82f6;
        }

        .support-solution h4 {
            color: #f1f5f9;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .support-solution p {
            color: #94a3b8;
            font-size: 14px;
            line-height: 1.5;
        }

        .support-modal-footer {
            padding: 24px 32px;
            border-top: 1px solid rgba(51, 65, 85, 0.5);
            text-align: center;
        }

        .support-modal-footer p {
            color: #f1f5f9;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 16px;
        }

        .support-btn-group {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        .support-btn {
            padding: 12px 32px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
        }

        .support-btn-yes {
            background: #10b981;
            color: white;
        }

        .support-btn-yes:hover {
            background: #059669;
        }

        .support-btn-no {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
            border: 1px solid #ef4444;
        }

        .support-btn-no:hover {
            background: #ef4444;
            color: white;
        }

        .support-close-btn {
            position: absolute;
            top: 16px;
            right: 16px;
            width: 32px;
            height: 32px;
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid #334155;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .support-close-btn:hover {
            background: rgba(30, 41, 59, 0.8);
            border-color: #3b82f6;
        }

        .support-close-btn svg {
            width: 16px;
            height: 16px;
            stroke: #f1f5f9;
        }

        .support-chat-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(10, 14, 39, 0.95);
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1001;
            padding: 20px;
            animation: fadeIn 0.3s;
        }

        .support-chat-window {
            background: #0f1629;
            border: 1px solid #1e293b;
            border-radius: 24px;
            max-width: 700px;
            width: 100%;
            height: 600px;
            display: flex;
            flex-direction: column;
            animation: slideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .support-chat-header {
            padding: 20px 24px;
            border-bottom: 1px solid #1e293b;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .support-chat-header-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .support-chat-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .support-chat-avatar svg {
            width: 20px;
            height: 20px;
            stroke: white;
        }

        .support-chat-operator {
            color: #f1f5f9;
            font-size: 16px;
            font-weight: 600;
        }

        .support-chat-status {
            color: #10b981;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .support-chat-status::before {
            content: '';
            width: 8px;
            height: 8px;
            background: #10b981;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }

        .support-chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .support-chat-message {
            display: flex;
            gap: 12px;
            max-width: 80%;
        }

        .support-chat-message.user {
            margin-left: auto;
            flex-direction: row-reverse;
        }

        .support-chat-message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .support-chat-message-avatar.operator {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .support-chat-message-avatar.user {
            background: linear-gradient(135deg, #10b981, #059669);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .support-chat-message-avatar svg {
            width: 16px;
            height: 16px;
            stroke: white;
        }

        .support-chat-message-content {
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid #334155;
            border-radius: 16px;
            padding: 12px 16px;
            color: #f1f5f9;
            font-size: 14px;
            line-height: 1.5;
        }

        .support-chat-message.user .support-chat-message-content {
            background: rgba(59, 130, 246, 0.1);
            border-color: rgba(59, 130, 246, 0.3);
        }

        .support-chat-message-time {
            color: #64748b;
            font-size: 11px;
            margin-top: 4px;
        }

        .support-chat-input-container {
            padding: 20px 24px;
            border-top: 1px solid #1e293b;
            display: flex;
            gap: 12px;
        }

        .support-chat-input {
            flex: 1;
            height: 44px;
            padding: 0 16px;
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid #334155;
            border-radius: 12px;
            color: #f1f5f9;
            font-size: 14px;
        }

        .support-chat-input:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .support-chat-send-btn {
            width: 44px;
            height: 44px;
            background: #3b82f6;
            border: none;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .support-chat-send-btn:hover {
            background: #2563eb;
        }

        .support-chat-send-btn svg {
            width: 20px;
            height: 20px;
            stroke: white;
        }

        .ripple-container {
            position: relative;
            overflow: hidden;
        }

        .ripple {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.6);
            transform: scale(0);
            animation: ripple-animation 0.6s ease-out;
            pointer-events: none;
        }

        @keyframes ripple-animation {
            to {
                transform: scale(4);
                opacity: 0;
            }
        }

        .nav-item,
        button,
        .post-card,
        .chat-item,
        .support-category,
        .support-solution,
        .rule-card,
        .leaderboard-item,
        .upload-button,
        .submit-button,
        .support-btn,
        .chat-send-btn,
        .support-chat-send-btn {
            position: relative;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <div class="sidebar-header">
                <h2 class="sidebar-title">Меню</h2>
            </div>
            <nav class="sidebar-nav">
                <div class="nav-item active" data-tab="profile">
                    <svg class="nav-icon" viewBox="0 0 24 24">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                    <span>Профиль</span>
                </div>
                <div class="nav-item" data-tab="charity">
                    <svg class="nav-icon" viewBox="0 0 24 24">
                        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                    </svg>
                    <span>Благотворительность</span>
                </div>
                <div class="nav-item hidden" data-tab="chats">
                    <svg class="nav-icon" viewBox="0 0 24 24">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                    </svg>
                    <span>Чаты</span>
                    <span class="notification-badge" id="chatsNotificationBadge" style="display: none;"></span>
                </div>
                <div class="nav-item hidden" data-tab="rating">
                    <svg class="nav-icon" viewBox="0 0 24 24">
                        <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                    </svg>
                    <span>Рейтинг</span>
                </div>
                <div class="nav-item" data-tab="info">
                    <svg class="nav-icon" viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" y1="16" x2="12" y2="12"></line>
                        <line x1="12" y1="8" x2="12.01" y2="8"></line>
                    </svg>
                    <span>Поддержка</span>
                </div>
                <div class="nav-item" data-tab="rules">
                    <svg class="nav-icon" viewBox="0 0 24 24">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                        <line x1="16" y1="13" x2="8" y2="13"></line>
                        <line x1="16" y1="17" x2="8" y2="17"></line>
                        <polyline points="10 9 9 9 8 9"></polyline>
                    </svg>
                    <span>Правила</span>
                </div>
            </nav>
        </div>

        <div class="card">
            <div class="content-section active" id="profile">
                <div class="header">
                    <div class="icon-wrapper">
                        <svg class="user-icon" viewBox="0 0 24 24">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                    </div>
                    <h1>Профиль</h1>
                    <p class="subtitle">Заполните информацию о себе</p>
                </div>

                <form id="profileForm">
                    <div class="photo-section">
                        <div class="photo-wrapper">
                            <div class="photo-preview" id="photoPreview">
                                <svg viewBox="0 0 24 24">
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="12" cy="7" r="4"></circle>
                                </svg>
                            </div>
                            <label for="photoInput" class="upload-button">
                                <svg viewBox="0 0 24 24">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                    <polyline points="17 8 12 3 7 8"></polyline>
                                    <line x1="12" y1="3" x2="12" y2="15"></line>
                                </svg>
                            </label>
                            <input type="file" id="photoInput" accept="image/*">
                        </div>
                        <p class="photo-hint">Нажмите, чтобы загрузить фото</p>
                    </div>

                    <div class="form-group">
                        <label for="firstName">Имя *</label>
                        <div class="input-wrapper">
                            <svg class="input-icon" viewBox="0 0 24 24">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                <circle cx="12" cy="7" r="4"></circle>
                            </svg>
                            <input type="text" id="firstName" placeholder="Введите ваше имя">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="lastName">Фамилия</label>
                        <div class="input-wrapper">
                            <svg class="input-icon" viewBox="0 0 24 24">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                <circle cx="12" cy="7" r="4"></circle>
                            </svg>
                            <input type="text" id="lastName" placeholder="Введите вашу фамилию">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="phone">Номер телефона *</label>
                        <div class="input-wrapper">
                            <svg class="input-icon" viewBox="0 0 24 24">
                                <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                            </svg>
                            <input type="tel" id="phone" placeholder="+7 (___) ___-__-__">
                        </div>
                    </div>

                    <button type="submit" class="submit-button">Сохранить</button>
                </form>

                <div class="footer">
                    <p class="footer-text">
                        Нажимая "Сохранить", вы соглашаетесь с условиями использования
                    </p>
                </div>
            </div>

            <!-- New charity section with buttons, intro form, and posts -->
            <div class="content-section" id="charity">
                <div class="header">
                    <div class="icon-wrapper">
                        <svg class="user-icon" viewBox="0 0 24 24">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                    </div>
                    <h1>Благотворительность</h1>
                    <p class="subtitle">Помогите тем, кто нуждается в поддержке</p>
                </div>

                <div id="charityInitial">
                    <div class="charity-buttons">
                        <button class="charity-button" id="wantToHelpBtn">
                            <svg viewBox="0 0 24 24">
                                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                            </svg>
                            Я хочу помочь
                        </button>
                        <button class="charity-button" id="needHelpBtn">
                            <svg viewBox="0 0 24 24">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="12" y1="8" x2="12" y2="12"></line>
                                <line x1="12" y1="16" x2="12.01" y2="16"></line>
                            </svg>
                            Мне нужна помощь
                        </button>
                    </div>
                </div>

                <div id="introForm" style="display: none;">
                    <div class="intro-form">
                        <h2>Представьтесь, пожалуйста</h2>
                        <p>Чтобы продолжить, пожалуйста, представьтесь</p>
                        <form id="helperForm">
                            <div class="form-group">
                                <label for="helperName">Ваше имя</label>
                                <div class="input-wrapper">
                                    <svg class="input-icon" viewBox="0 0 24 24">
                                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                        <circle cx="12" cy="7" r="4"></circle>
                                    </svg>
                                    <input type="text" id="helperName" placeholder="Введите ваше имя" required>
                                </div>
                            </div>
                            <button type="submit" class="submit-button">Продолжить</button>
                        </form>
                    </div>
                </div>

                <div id="postsList" style="display: none;">
                    <div style="display: flex; justify-content: center; margin-bottom: 32px;">
                        <button id="paymentDetailsBtn" class="payment-details-button">
                            <svg viewBox="0 0 24 24" style="width: 24px; height: 24px; stroke: currentColor; stroke-width: 2; fill: none;">
                                <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
                                <line x1="1" y1="10" x2="23" y2="10"></line>
                            </svg>
                            Реквизиты для помощи
                        </button>
                    </div>
                    <div class="posts-grid" id="postsContainer"></div>
                </div>
                
                <!-- Блок отображения созданного поста пользователя -->
                <div id="userPostView" style="display: none;">
                    <div class="post-card" style="max-width: 700px; margin: 0 auto; background: rgba(30, 41, 59, 0.4); border: 1px solid #334155; border-radius: 16px; overflow: hidden;">
                        <!-- Галерея медиа - отдельно от текста -->
                        <div id="userPostMediaGallery" style="width: 100%; background: rgba(15, 22, 41, 0.6); padding: 0;">
                            <!-- Медиа будут добавлены динамически -->
                            </div>
                        <!-- Контент поста -->
                        <div class="post-content" style="padding: 24px;">
                            <div class="post-header" style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                                <div class="post-avatar" style="width: 48px; height: 48px; border-radius: 50%; background: rgba(59, 130, 246, 0.2); display: flex; align-items: center; justify-content: center; overflow: hidden; flex-shrink: 0;">
                                    <img id="userPostAvatar" src="/placeholder.svg" alt="" style="width: 100%; height: 100%; object-fit: cover;">
                        </div>
                                <span class="post-author" id="userPostAuthor" style="font-size: 16px; font-weight: 600; color: #f1f5f9;"></span>
                    </div>
                            <h2 class="post-title" id="userPostTitle" style="font-size: 22px; font-weight: 700; color: #f1f5f9; margin-bottom: 12px;"></h2>
                            <p class="post-description" id="userPostDescription" style="font-size: 15px; color: #94a3b8; line-height: 1.6; margin-bottom: 20px; white-space: pre-wrap;"></p>
                            <div class="post-progress" style="margin-bottom: 20px;">
                                <div class="progress-bar" style="width: 100%; height: 10px; background: rgba(30, 41, 59, 0.5); border-radius: 5px; overflow: hidden; margin-bottom: 8px;">
                                    <div class="progress-fill" id="userPostProgress" style="height: 100%; background: linear-gradient(90deg, #3b82f6, #8b5cf6); transition: width 0.3s; border-radius: 5px;"></div>
                                </div>
                                <div class="progress-text" style="display: flex; justify-content: space-between; align-items: center; font-size: 14px; color: #64748b; margin-top: 12px;">
                                    <span id="userPostCollected">Собрано: <span style="color: #10b981; font-weight: 600;">0 ₽</span></span>
                                    <span id="userPostAmount" class="user-post-amount-badge"></span>
                                </div>
                            </div>
                            <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(51, 65, 85, 0.5);">
                                <p style="color: #94a3b8; font-size: 14px; margin-bottom: 8px;"><strong style="color: #e2e8f0;">Получатель:</strong> <span id="userPostRecipient"></span></p>
                                <p style="color: #94a3b8; font-size: 14px; margin-bottom: 8px;"><strong style="color: #e2e8f0;">Банк:</strong> <span id="userPostBank"></span></p>
                                <p style="color: #94a3b8; font-size: 14px;"><strong style="color: #e2e8f0;">Телефон:</strong> <span id="userPostPhone"></span></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="content-section" id="rating">
                <div class="rating-container">
                    <div class="header" style="margin-bottom: 24px;">
                        <div class="icon-wrapper">
                            <svg class="user-icon" viewBox="0 0 24 24">
                        <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                    </svg>
                </div>
                        <h1>Рейтинг благотворителей</h1>
                        <p class="subtitle">Топ пользователей, которые помогают другим</p>
            </div>

                    <!-- Info box about rating system -->
                    <div class="info-box">
                        <h3>
                            <svg style="width: 20px; height: 20px; stroke: currentColor;" viewBox="0 0 24 24" fill="none" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" y1="16" x2="12" y2="12"></line>
                        <line x1="12" y1="8" x2="12.01" y2="8"></line>
                    </svg>
                            Как работает система рейтинга
                        </h3>
                        <div style="margin-bottom: 16px; color: #94a3b8; font-size: 14px; line-height: 1.6;">
                            <strong style="color: #f1f5f9;">50 рублей = 5 баллов.</strong> За каждое пожертвование вы получаете баллы, которые определяют ваш статус и место в рейтинге. 
                            Значки 🥇 🥈 🥉 присваиваются топ-3 пользователям и обновляются ежедневно.
                        </div>
                        <div class="info-content">
                            <div class="status-info">
                                <div class="status-name">Друг Платформы</div>
                                <div class="status-points">5 — 500 баллов</div>
                            </div>
                            <div class="status-info">
                                <div class="status-name">Хранитель Надежды</div>
                                <div class="status-points">501 — 2 500 баллов</div>
                            </div>
                            <div class="status-info">
                                <div class="status-name">Благотворитель</div>
                                <div class="status-points">2 501 — 5 500 баллов</div>
                            </div>
                            <div class="status-info">
                                <div class="status-name">Пламенное Сердце</div>
                                <div class="status-points">от 5 501 балла</div>
                            </div>
                        </div>
                    </div>

                    <!-- User's own rating -->
                    <div class="user-rating-card" id="userRatingCard">
                        <div class="user-rating-avatar">
                            <svg viewBox="0 0 24 24" stroke="#64748b" stroke-width="2" fill="none">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                <circle cx="12" cy="7" r="4"></circle>
                            </svg>
                        </div>
                        <div class="user-rating-info">
                            <div class="user-rating-header">
                                <div class="user-rating-name" id="userRatingName">Ваш рейтинг</div>
                                <div class="rank-badge rank-1" id="userRankBadge" style="display: none;">1</div>
                            </div>
                            <div class="user-rating-status" id="userRatingStatus">Начните помогать, чтобы получить статус</div>
                            <div class="user-rating-stats">
                                <div class="rating-stat">
                                    <div class="rating-stat-label">Всего баллов</div>
                                    <div class="rating-stat-value" id="userTotalPoints">0</div>
                                </div>
                                <div class="rating-stat">
                                    <div class="rating-stat-label">Место в рейтинге</div>
                                    <div class="rating-stat-value" id="userRankPosition">—</div>
                                </div>
                                <div class="rating-stat">
                                    <div class="rating-stat-label">Пожертвовано</div>
                                    <div class="rating-stat-value" id="userTotalDonated">0 ₽</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Leaderboard -->
                    <div class="leaderboard">
                        <h2 class="leaderboard-title">Топ благотворителей</h2>
                        <div id="leaderboardList"></div>
                    </div>
                </div>
            </div>

            <div class="content-section" id="info">
                <div class="support-container">
                    <div class="header" style="margin-bottom: 32px;">
                        <div class="icon-wrapper">
                            <svg class="user-icon" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                                <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path>
                            </svg>
                        </div>
                        <h1>Поддержка</h1>
                        <p class="subtitle">Мы поможем решить вашу проблему</p>
                    </div>

                    <div class="support-categories">
                        <div class="support-category" id="authProblems">
                            <div class="support-category-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke-width="2">
                                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                                    <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                                </svg>
                            </div>
                            <h3>Проблемы с авторизацией</h3>
                            <p>Не могу войти в аккаунт, забыл пароль, проблемы с телефоном</p>
                        </div>

                        <div class="support-category" id="sendMoneyProblems">
                            <div class="support-category-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke-width="2">
                                    <line x1="12" y1="1" x2="12" y2="23"></line>
                                    <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                                </svg>
                            </div>
                            <h3>Проблемы с переводом средств</h3>
                            <p>Не могу отправить деньги, перевод не прошел, проблемы с реквизитами</p>
                        </div>

                        <div class="support-category" id="receiveMoneyProblems">
                            <div class="support-category-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke-width="2">
                                    <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                                </svg>
                            </div>
                            <h3>Проблемы с получением средств</h3>
                            <p>Не пришли деньги, проблемы с верификацией, пост не отображается</p>
                        </div>

                        <div class="support-category" id="otherProblems">
                            <div class="support-category-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                    <line x1="12" y1="17" x2="12.01" y2="17"></line>
                                </svg>
                            </div>
                            <h3>Иное</h3>
                            <p>Другие вопросы и проблемы</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="content-section" id="rules">
                <div class="rules-container">
                    <div class="header" style="margin-bottom: 32px;">
                        <div class="icon-wrapper">
                            <svg class="user-icon" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                        <line x1="16" y1="13" x2="8" y2="13"></line>
                        <line x1="16" y1="17" x2="8" y2="17"></line>
                    </svg>
                        </div>
                        <h1>Правила платформы</h1>
                        <p class="subtitle">Ознакомьтесь с правилами использования</p>
                    </div>

                    <!-- Platform rules -->
                    <div class="platform-rules">
                        <h2>Правила платформы "Макс"</h2>
                        <p class="platform-rules-subtitle">Общие положения для всех пользователей</p>
                        
                        <div class="platform-rule-item">
                            <div class="platform-rule-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke-width="2">
                                    <polyline points="20 6 9 17 4 12"></polyline>
                                </svg>
                            </div>
                            <div class="platform-rule-text">
                                <strong>Честность и прозрачность:</strong> Вся информация на платформе должна быть правдивой. Предоставление ложных данных или документов приведет к немедленной блокировке аккаунта.
                            </div>
                        </div>

                        <div class="platform-rule-item">
                            <div class="platform-rule-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke-width="2">
                                    <polyline points="20 6 9 17 4 12"></polyline>
                                </svg>
                            </div>
                            <div class="platform-rule-text">
                                <strong>Уважение к другим:</strong> Запрещены оскорбления, угрозы и любые формы дискриминации. Общайтесь с другими пользователями вежливо и уважительно.
                            </div>
                        </div>

                        <div class="platform-rule-item">
                            <div class="platform-rule-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke-width="2">
                                    <polyline points="20 6 9 17 4 12"></polyline>
                                </svg>
                            </div>
                            <div class="platform-rule-text">
                                <strong>Конфиденциальность:</strong> Защита персональных данных — наш приоритет. Не распространяйте чужую личную информацию без согласия.
                            </div>
                        </div>

                        <div class="platform-rule-item">
                            <div class="platform-rule-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke-width="2">
                                    <polyline points="20 6 9 17 4 12"></polyline>
                                </svg>
                            </div>
                            <div class="platform-rule-text">
                                <strong>Запрет на мошенничество:</strong> Любые попытки обмана, создания фальшивых аккаунтов или манипуляций с системой строго запрещены и караются блокировкой.
                            </div>
                        </div>

                        <div class="platform-rule-item">
                            <div class="platform-rule-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke-width="2">
                                    <polyline points="20 6 9 17 4 12"></polyline>
                                </svg>
                            </div>
                            <div class="platform-rule-text">
                                <strong>Возрастные ограничения:</strong> Для регистрации на платформе вам должно быть не менее 18 лет. Верификация личности обязательна для создания постов о помощи.
                            </div>
                        </div>
                    </div>

                    <!-- Rules for helpers -->
                    <div class="rules-section">
                        <h2 class="rules-section-title">Для тех, кто помогает 💙</h2>
                        <div class="rules-grid">
                            <div class="rule-card">
                                <div class="rule-card-number">1</div>
                                <h3 class="rule-card-title">Представление</h3>
                                <p class="rule-card-description">
                                    При первом входе в раздел "Благотворительность" вам нужно представиться — указать ваше имя. 
                                    Это позволит верифицироваться на платформе.
                                </p>
                            </div>

                            <div class="rule-card">
                                <div class="rule-card-number">2</div>
                                <h3 class="rule-card-title">Выбор получателя</h3>
                                <p class="rule-card-description">
                                    После представления вы получите доступ ко всем постам людей, нуждающихся в помощи. 
                                    Вы можете просмотреть их истории и цели сбора.
                                </p>
                            </div>

                            <div class="rule-card">
                                <div class="rule-card-number">3</div>
                                <h3 class="rule-card-title">Пожертвование</h3>
                                <p class="rule-card-description">
                                    Выберите сумму, которую хотите пожертвовать. Переведите деньги по указанным реквизитам получателя.
                                </p>
                            </div>

                            <div class="rule-card">
                                <div class="rule-card-number">4</div>
                                <h3 class="rule-card-title">Рейтинг и статусы</h3>
                                <p class="rule-card-description">
                                    За пожертвования вы получаете баллы и статусы: от "Друг Платформы" до "Пламенное Сердце". 
                                    Топ-3 благотворителя получают ежедневные значки.
                                    Подробнее во вкладке "Рейтинг"*
                                </p>
                            </div>

                            <div class="rule-card">
                                <div class="rule-card-number">5</div>
                                <h3 class="rule-card-title">Общение</h3>
                                <p class="rule-card-description">
                                    После пожертвования открывается раздел "Чаты", где вы можете общаться с получателями помощи, 
                                    следить за их прогрессом и получать благодарности.
                                </p>
                            </div>

                            <div class="rule-card">
                                <div class="rule-card-number">6</div>
                                <h3 class="rule-card-title">Дополнительная информация</h3>
                                <p class="rule-card-description">
                                    В разделе "Поддержка" вы найдете ответы на часто задаваемые вопросы и способы связи с поддержкой.
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Rules for those who need help -->
                    <div class="rules-section">
                        <h2 class="rules-section-title">Для тех, кому нужна помощь 🙏</h2>
                        <div class="rules-grid">
                            <div class="rule-card">
                                <div class="rule-card-number">1</div>
                                <h3 class="rule-card-title">Верификация личности</h3>
                                <p class="rule-card-description">
                                    Нажмите "Мне нужна помощь" и заполните форму верификации: ФИО, дата рождения, 
                                    паспортные данные, ИНН/СНИЛС. Загрузите фото/сканы паспорта.
                                </p>
                            </div>

                            <div class="rule-card">
                                <div class="rule-card-number">2</div>
                                <h3 class="rule-card-title">Согласие с условиями</h3>
                                <p class="rule-card-description">
                                    Подтвердите три обязательных пункта: согласие на обработку персональных данных, 
                                    подтверждение подлинности данных и их правдивости.
                                </p>
                            </div>

                            <div class="rule-card">
                                <div class="rule-card-number">3</div>
                                <h3 class="rule-card-title">Проверка данных</h3>
                                <p class="rule-card-description">
                                    После отправки ваши данные проверяются модераторами. Обычно это занимает 2-5 минут. 
                                    При несовпадении данных с фото — блокировка аккаунта.
                                </p>
                            </div>

                            <div class="rule-card">
                                <div class="rule-card-number">4</div>
                                <h3 class="rule-card-title">Создание поста</h3>
                                <p class="rule-card-description">
                                    После одобрения создайте пост: загрузите фото/видео, напишите название и описание (до 10 000 символов), 
                                    укажите реквизиты и необходимую сумму.
                                </p>
                            </div>

                            <div class="rule-card">
                                <div class="rule-card-number">5</div>
                                <h3 class="rule-card-title">Ваш пост</h3>
                                <p class="rule-card-description">
                                    В разделе "Благотворительность" вы видите только свой пост. Вы можете редактировать всё: 
                                    название, описание, фото, реквизиты — кроме суммы сбора.
                                </p>
                            </div>

                            <div class="rule-card">
                                <div class="rule-card-number">6</div>
                                <h3 class="rule-card-title">Чаты с благотворителями</h3>
                                <p class="rule-card-description">
                                    После первого пожертвования откроется раздел "Чаты". Там вы сможете общаться с людьми, 
                                    которые вам помогли, и поблагодарить их.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ADDING CHATS SECTION -->
            <div class="content-section" id="chats">
                <div class="chats-list-view" id="chatsListView">
                    <div class="header">
                        <div class="icon-wrapper">
                            <svg class="user-icon" viewBox="0 0 24 24">
                                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                            </svg>
                        </div>
                        <h1>Чаты</h1>
                        <p class="subtitle">Ваши диалоги с получателями помощи</p>
                    </div>

                    <div class="chats-list" id="chatsList">
                        <!-- Chats will be dynamically added here -->
                    </div>

                    <div id="emptyChats" class="empty-content">
                        <svg class="empty-icon" viewBox="0 0 24 24">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                        </svg>
                        <h2 class="empty-title">Нет активных чатов</h2>
                        <p id="chatsDescription" class="empty-description">После подтверждения вашего пожертвования<br>здесь появятся диалоги с получателями помощи</p>
                    </div>
                </div>

                <div class="chat-view" id="chatView">
                    <div class="chat-header">
                        <button class="chat-back-btn" id="chatBackBtn">
                            <svg viewBox="0 0 24 24">
                                <line x1="19" y1="12" x2="5" y2="12"></line>
                                <polyline points="12 19 5 12 12 5"></polyline>
                            </svg>
                        </button>
                        <img src="/placeholder.svg" alt="" class="chat-avatar" id="chatRecipientAvatar">
                        <div class="chat-header-info">
                            <div class="chat-header-name" id="chatRecipientName">Анна С.</div>
                            <div class="chat-header-status">онлайн</div>
                        </div>
                    </div>
                    <div class="chat-messages" id="chatMessages">
                        <!-- Messages will be dynamically added here -->
                    </div>
                    <div class="chat-input-area">
                        <div class="emoji-picker">
                            <button class="emoji-btn" data-emoji="😊">😊</button>
                            <button class="emoji-btn" data-emoji="❤️">❤️</button>
                            <button class="emoji-btn" data-emoji="🙏">🙏</button>
                            <button class="emoji-btn" data-emoji="👍">👍</button>
                            <button class="emoji-btn" data-emoji="🎉">🎉</button>
                            <button class="emoji-btn" data-emoji="💪">💪</button>
                            <button class="emoji-btn" data-emoji="🌟">🌟</button>
                            <button class="emoji-btn" data-emoji="✨">✨</button>
                        </div>
                        <div class="chat-input-wrapper">
                            <input type="text" class="chat-input" id="chatInput" placeholder="Напишите сообщение...">
                            <label for="chatAttachment" class="chat-attach-btn">
                                <svg viewBox="0 0 24 24">
                                    <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path>
                                </svg>
                            </label>
                            <input type="file" id="chatAttachment" accept="image/*,video/*" style="display: none;">
                            <button class="chat-send-btn" id="sendMessage">
                                <svg viewBox="0 0 24 24">
                                    <line x1="22" y1="2" x2="11" y2="13"></line>
                                    <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Payment Details Modal -->
    <div class="payment-modal" id="paymentModal">
        <div class="payment-modal-content">
            <button class="payment-modal-close" id="closePaymentModal">
                <svg viewBox="0 0 24 24">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
            <h2 style="color: #f1f5f9; font-size: 24px; font-weight: 700; margin-bottom: 24px; text-align: center;">Реквизиты для помощи</h2>
            
            <div style="background: rgba(30, 41, 59, 0.5); border: 1px solid #334155; border-radius: 12px; padding: 20px; margin-bottom: 24px;">
                <h3 style="color: #f1f5f9; font-size: 18px; font-weight: 600; margin-bottom: 16px;">Инструкция по переводу</h3>
                <div style="color: #94a3b8; font-size: 14px; line-height: 1.8;">
                    <p style="margin-bottom: 12px;">Для того чтобы помочь нуждающемуся, выполните следующие шаги:</p>
                    <ol style="margin-left: 20px; margin-bottom: 12px;">
                        <li style="margin-bottom: 8px;">Откройте приложение вашего банка или перейдите на сайт банка</li>
                        <li style="margin-bottom: 8px;">Выберите операцию "Перевод" или "Платеж"</li>
                        <li style="margin-bottom: 8px;">Введите лицевой счет получателя (указан ниже)</li>
                        <li style="margin-bottom: 8px;">Укажите сумму перевода</li>
                        <li style="margin-bottom: 8px;"><strong style="color: #3b82f6;">Обязательно укажите в комментарии к переводу ID поста</strong> (ID указан справа вверху на карточке поста)</li>
                        <li style="margin-bottom: 8px;">Проверьте данные и подтвердите перевод</li>
                    </ol>
                    <p style="color: #fbbf24; font-weight: 600; margin-top: 16px;">⚠️ Важно: Без указания ID поста в комментарии мы не сможем определить, кому именно предназначена помощь!</p>
                </div>
            </div>

            <div style="background: rgba(30, 41, 59, 0.5); border: 1px solid #334155; border-radius: 12px; padding: 20px; margin-bottom: 24px;">
                <h3 style="color: #f1f5f9; font-size: 18px; font-weight: 600; margin-bottom: 16px;">Реквизиты получателя</h3>
                <div style="color: #94a3b8; font-size: 14px; line-height: 1.8;">
                    <p style="margin-bottom: 12px;"><strong style="color: #f1f5f9;">Получатель:</strong> ООО "Max"</p>
                    <p style="margin-bottom: 12px;"><strong style="color: #f1f5f9;">ИНН:</strong> 7707083893</p>
                    <p style="margin-bottom: 12px;"><strong style="color: #f1f5f9;">КПП:</strong> 770701001</p>
                    <p style="margin-bottom: 12px;"><strong style="color: #f1f5f9;">Банк:</strong> ПАО "Сбербанк"</p>
                    <p style="margin-bottom: 12px;"><strong style="color: #f1f5f9;">БИК:</strong> 044525225</p>
                    <p style="margin-bottom: 12px;"><strong style="color: #f1f5f9;">Корр. счет:</strong> 30101810400000000225</p>
                    <p style="margin-bottom: 0;"><strong style="color: #3b82f6; font-size: 16px;">Лицевой счет:</strong> <span id="accountNumber" style="color: #3b82f6; font-size: 18px; font-weight: 700; font-family: 'Courier New', monospace; letter-spacing: 1px;">40817810099910004312</span></p>
                </div>
            </div>

            <div style="background: rgba(30, 41, 59, 0.5); border: 1px solid #334155; border-radius: 12px; padding: 20px; text-align: center; margin-bottom: 24px;">
                <h3 style="color: #f1f5f9; font-size: 18px; font-weight: 600; margin-bottom: 16px;">QR-код для быстрого перевода</h3>
                <p style="color: #64748b; font-size: 13px; margin-bottom: 16px;">Отсканируйте QR-код в приложении вашего банка для быстрого перевода</p>
                <div id="qrCodeContainer" style="display: flex; justify-content: center; align-items: center; background: white; padding: 20px; border-radius: 12px; margin: 0 auto; width: fit-content;">
                    <img src="http://qrcoder.ru/code/?%CF%EE%EB%F3%F7%E0%F2%E5%EB%FC%3A+%CE%CE%CE+%22%CC%E0%EA%F1%22%0D%0A%0D%0A%C8%CD%CD%3A+7707083893%0D%0A%0D%0A%CA%CF%CF%3A+770701001%0D%0A%0D%0A%C1%E0%ED%EA%3A+%CF%C0%CE+%22%D1%E1%E5%F0%E1%E0%ED%EA%22%0D%0A%0D%0A%C1%C8%CA%3A+044525225%0D%0A%0D%0A%CA%EE%F0%F0.+%F1%F7%E5%F2%3A+30101810400000000225%0D%0A%0D%0A%CB%E8%F6%E5%E2%EE%E9+%F1%F7%E5%F2%3A+40817810099910004312&4&0" width="276" height="276" border="0" alt="QR код для перевода" style="display: block;">
                </div>
            </div>

            <div style="background: rgba(30, 41, 59, 0.5); border: 1px solid #334155; border-radius: 12px; padding: 20px;">
                <h3 style="color: #f1f5f9; font-size: 18px; font-weight: 600; margin-bottom: 16px;">Загрузка чека о переводе</h3>
                <p style="color: #94a3b8; font-size: 14px; line-height: 1.6; margin-bottom: 16px;">
                    После совершения перевода, пожалуйста, загрузите чек или скриншот операции для подтверждения платежа. 
                    Это поможет нам быстрее обработать ваше пожертвование и направить средства нуждающемуся.
                </p>
                <div style="background: rgba(15, 22, 41, 0.5); border: 1px solid #334155; border-radius: 8px; padding: 12px; margin-bottom: 16px;">
                    <p style="color: #64748b; font-size: 12px; margin-bottom: 8px;"><strong style="color: #f1f5f9;">Доступные форматы:</strong> JPG, PNG, PDF</p>
                    <p style="color: #64748b; font-size: 12px; margin-bottom: 0;"><strong style="color: #f1f5f9;">Максимальный размер файла:</strong> 10 МБ</p>
                </div>
                <div style="border: 2px dashed #334155; border-radius: 12px; padding: 24px; text-align: center; cursor: pointer; transition: all 0.2s; margin-bottom: 16px;" id="receiptUploadArea">
                    <input type="file" id="receiptFileInput" accept="image/jpeg,image/png,image/jpg,application/pdf" style="display: none;">
                    <svg style="width: 48px; height: 48px; stroke: #64748b; margin: 0 auto 12px;" viewBox="0 0 24 24" fill="none" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="17 8 12 3 7 8"></polyline>
                        <line x1="12" y1="3" x2="12" y2="15"></line>
                    </svg>
                    <p style="color: #f1f5f9; font-size: 14px; font-weight: 600; margin-bottom: 4px;">Нажмите для загрузки чека</p>
                    <p style="color: #64748b; font-size: 12px;">или перетащите файл сюда</p>
                    <p id="receiptFileName" style="color: #3b82f6; font-size: 13px; margin-top: 8px; display: none;"></p>
                </div>
                <button id="submitReceiptBtn" class="submit-receipt-button" style="width: 100%; height: 48px; background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); border: none; border-radius: 12px; color: white; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s; display: none;">
                    Отправить чек
                </button>
            </div>
        </div>
    </div>

    <!-- Receipt Processing Modal -->
    <div class="receipt-processing-modal" id="receiptProcessingModal">
        <div class="receipt-processing-content">
            <div style="width: 80px; height: 80px; border: 4px solid #334155; border-top-color: #3b82f6; border-radius: 50%; margin: 0 auto 24px; animation: spin 1s linear infinite;"></div>
            <style>
                @keyframes spin {
                    to { transform: rotate(360deg); }
                }
            </style>
            <h2 style="color: #f1f5f9; font-size: 24px; font-weight: 700; margin-bottom: 12px; text-align: center;">Обработка чека</h2>
            <p style="color: #64748b; font-size: 14px; line-height: 1.6; margin-bottom: 24px; text-align: center;">
                Мы обрабатываем ваш чек о переводе. Это может занять некоторое время. 
                Вы получите уведомление, когда обработка будет завершена.
            </p>
            <p style="color: #3b82f6; font-size: 13px; font-weight: 600; text-align: center; margin-bottom: 24px;">Обычно обработка занимает 2-5 минут</p>
            <button id="closeReceiptProcessingModal" style="width: 100%; height: 48px; background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); border: none; border-radius: 12px; color: white; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s;">
                OK
            </button>
        </div>
    </div>

    <!-- Post detail modal -->
    <div class="post-detail" id="postDetail">
        <div class="post-detail-content">
            <div class="post-detail-header">
                <img src="/placeholder.svg" alt="" class="post-detail-image" id="detailImage">
                <button class="close-button" id="closeDetail">
                    <svg viewBox="0 0 24 24">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="post-detail-body">
                <!-- Adding author section with avatar -->
                <div class="detail-author">
                    <img src="/placeholder.svg" alt="" class="detail-avatar" id="detailAuthorAvatar">
                    <div class="detail-author-info">
                        <h3 id="detailAuthorName"></h3>
                        <p>Нуждается в помощи</p>
                    </div>
                </div>

                <h2 class="post-detail-title" id="detailTitle"></h2>
                <p class="post-detail-description" id="detailDescription"></p>
                
                <div class="post-detail-info">
                        <div class="amount-display" id="detailAmount" style="--progress-width: 0%"></div>
                    </div>
                <div class="detail-post-id" id="detailPostId"></div>
            </div>
        </div>
    </div>

    <!-- CHAT CONTAINER (NOW FULLSCREEN ON MOBILE, AND MODAL ON DESKTOP) -->
    <div class="chat-container" id="chatContainer">
        <div class="chat-header">
            <button class="chat-close" id="closeChat">
                <svg viewBox="0 0 24 24">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
            <img src="/placeholder.svg" alt="" class="chat-avatar" id="chatRecipientAvatar">
            <div class="chat-header-info">
                <div class="chat-header-name" id="chatRecipientName">Анна С.</div>
                <div class="chat-header-status">онлайн</div>
            </div>
        </div>
        <div class="chat-messages" id="chatMessages">
            <!-- Messages will be dynamically added here -->
        </div>
        <div class="chat-input-area">
            <div class="emoji-picker">
                <button class="emoji-btn" data-emoji="😊">😊</button>
                <button class="emoji-btn" data-emoji="❤️">❤️</button>
                <button class="emoji-btn" data-emoji="🙏">🙏</button>
                <button class="emoji-btn" data-emoji="👍">👍</button>
                <button class="emoji-btn" data-emoji="🎉">🎉</button>
                <button class="emoji-btn" data-emoji="💪">💪</button>
                <button class="emoji-btn" data-emoji="🌟">🌟</button>
                <button class="emoji-btn" data-emoji="✨">✨</button>
            </div>
            <div class="chat-input-wrapper">
                <input type="text" class="chat-input" id="chatInput" placeholder="Напишите сообщение...">
                <label for="chatAttachment" class="chat-attach-btn">
                    <svg viewBox="0 0 24 24">
                        <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path>
                    </svg>
                </label>
                <input type="file" id="chatAttachment" accept="image/*,video/*" style="display: none;">
                <button class="chat-send-btn" id="sendMessage">
                    <svg viewBox="0 0 24 24">
                        <line x1="22" y1="2" x2="11" y2="13"></line>
                        <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- QR Code Library -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            function getFromLocalStorage(key) {
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : null;
            }

            function saveToLocalStorage(key, value) {
                localStorage.setItem(key, JSON.stringify(value));
            }

            const charityPosts = [
                {
                    id: 1,
                    title: "Нужна помощь добраться домой",
                    authorName: "Анна Соколова",
                    authorFull: "Анна Соколова",
                    authorShort: "Анна С.",
                    avatar: "avatars/avatar-1.jpg",
                    description: "Здравствуйте! Меня зовут Анна, мне 24 года. Я застряла в чужом городе без денег и документов (украли сумку). Мне нужна помощь, чтобы купить билет домой в Москву. У меня дома ждет больная мама, которой нужен уход. Я обещаю вернуть деньги, как только доберусь до дома. Буду очень благодарна за любую помощь. Это действительно критическая ситуация для меня.",
                    amount: 5000,
                    recipient: "Анна С.",
                    bank: "Сбербанк",
                    phone: "+7 (912) 345-67-89",
                    image: "image/1.jfif"
                },
                {
                    id: 2,
                    title: "Лечение для ребенка",
                    authorName: "Мария Петрова",
                    authorFull: "Мария Петрова",
                    authorShort: "Мария П.",
                    avatar: "avatars/avatar-2.jpg",
                    description: "Меня зовут Мария. У моей дочки Саши (7 лет) серьезное заболевание, требуется дорогостоящее лечение и реабилитация. Мы одна семья, муж потерял работу из-за кризиса. Нам очень нужна помощь для оплаты курса лечения. Каждый рубль на счету. Врачи говорят, что есть шанс на выздоровление, но нужно действовать быстро. Пожалуйста, помогите нашей девочке встать на ноги!",
                    amount: 125000,
                    recipient: "Мария П.",
                    bank: "ВТБ",
                    phone: "+7 (923) 456-78-90",
                    image: "image/2.jpg"
                },
                {
                    id: 3,
                    title: "Восстановление после пожара",
                    authorName: "Петр Иванов",
                    authorFull: "Петр Иванов",
                    authorShort: "Петр И.",
                    avatar: "avatars/avatar-3.jpg",
                    description: "Добрый день. Меня зовут Петр, мне 45 лет. Месяц назад в нашем доме случился пожар. Мы с женой и двумя детьми потеряли все - дом, вещи, документы. Сейчас живем у родственников в тесноте. Очень нужна помощь на восстановление хотя бы минимальных условий для жизни - купить кровати, одежду, посуду. Работаю, но зарплаты не хватает, чтобы быстро все восстановить. Буду благодарен за любую помощь.",
                    amount: 75000,
                    recipient: "Петр И.",
                    bank: "Альфа-Банк",
                    phone: "+7 (934) 567-89-01",
                    image: "image/3.jfif"
                },
                {
                    id: 4,
                    title: "Помощь пожилой женщине",
                    authorName: "Вера Ивановна Смирнова",
                    authorFull: "Вера Ивановна Смирнова",
                    authorShort: "Вера И.",
                    avatar: "avatars/avatar-4.jpg",
                    description: "Здравствуйте, меня зовут Елена. Я помогаю своей пожилой соседке Вере Ивановне (82 года). Она живет одна, пенсия маленькая, а ей нужны дорогие лекарства от сердца и диабета. На прошлой неделе она сломала бедро, нужна операция. У меня самой возможностей ограничены. Прошу помочь этой доброй бабушке, которая всю жизнь помогала другим. Она очень скромная и не просит сама, но помощь действительно нужна.",
                    amount: 95000,
                    recipient: "Вера И.",
                    bank: "Тинькофф Банк",
                    phone: "+7 (945) 678-90-12",
                    image: "image/4.avif"
                },
                {
                    id: 5,
                    title: "Ремонт инвалидной коляски",
                    authorName: "Дмитрий Козлов",
                    authorFull: "Дмитрий Козлов",
                    authorShort: "Дмитрий К.",
                    avatar: "avatars/avatar-5.jpg",
                    description: "Привет! Я Дмитрий, 32 года, инвалид-колясочник. Моя коляска сломалась, а новая стоит очень дорого. Без коляски я не могу передвигаться, не могу работать удаленно и вести обычную жизнь. Пытался сэкономить, но средств все равно не хватает. Очень прошу помочь собрать на ремонт. Это для меня жизненно важно - коляска это моя свобода и независимость. Спасибо всем, кто откликнется!",
                    amount: 45000,
                    recipient: "Дмитрий К.",
                    bank: "Райффайзенбанк",
                    phone: "+7 (956) 789-01-23",
                    image: "image/5.webp"
                },
                {
                    id: 6,
                    title: "Корм для приюта животных",
                    authorName: "Алеся Волкова",
                    authorFull: "Алеся Волкова",
                    authorShort: "Алеся В.",
                    avatar: "avatars/avatar-6.jpg",
                    description: "Здравствуйте! Я волонтер приюта для бездомных животных 'Надежда'. У нас сейчас 47 собак и 32 кошки. Наши основные спонсоры приостановили финансирование, а корма осталось на неделю. Животные не виноваты в сложившейся ситуации. Нам срочно нужна помощь на закупку корма, ветеринарные услуги и содержание. Каждая копейка идет только на нужды животных. Помогите нам не бросить наших подопечных!",
                    amount: 67000,
                    recipient: "Алеся В.",
                    bank: "Сбербанк",
                    phone: "+7 (967) 890-12-34",
                    image: "image/6.jpg"
                },
                {
                    id: 7,
                    title: "Оплата общежития студенту",
                    authorName: "Максим Новиков",
                    authorFull: "Максим Новиков",
                    authorShort: "Максим Н.",
                    avatar: "avatars/avatar-7.jpg",
                    description: "Меня зовут Максим, я студент 3 курса технического университета. Учусь на бюджете, но место в общежитии платное. Родители из деревни, помочь не могут. Работаю по вечерам, но не успеваю заработать на оплату. Через неделю нужно внести оплату, иначе выселят, и я не смогу продолжить учебу. Очень хочу закончить университет и выбиться в люди. Прошу помочь оплатить семестр в общежитии. Обещаю так же помогать другим, когда встану на ноги.",
                    amount: 18000,
                    recipient: "Максим Н.",
                    bank: "ВТБ",
                    phone: "+7 (978) 901-23-45",
                    image: "image/7.jpeg"
                },
                {
                    id: 8,
                    title: "Протез ноги для ветерана",
                    authorName: "Николай Федорович Морозов",
                    authorFull: "Николай Федорович Морозов",
                    authorShort: "Николай Ф.",
                    avatar: "avatars/avatar-8.jpg",
                    description: "Добрый день! Я сын ветерана боевых действий. Моему отцу 68 лет, он потерял ногу на службе. Старый протез износился и причиняет боль. Новый протез стоит очень дорого. Пенсия у отца небольшая. Он всю жизнь служил Родине, а теперь нуждается в помощи. Хочу помочь ему, но моих средств не хватает. Прошу неравнодушных людей помочь ветерану обрести возможность ходить без боли.",
                    amount: 185000,
                    recipient: "Николай Ф.",
                    bank: "Газпромбанк",
                    phone: "+7 (989) 012-34-56",
                    image: "image/8.jpg"
                },
                {
                    id: 9,
                    title: "Образование для талантливого ребенка",
                    authorName: "Ольга Васильева",
                    authorFull: "Ольга Васильева",
                    authorShort: "Ольга В.",
                    avatar: "avatars/avatar-9.jpg",
                    description: "Здравствуйте, меня зовут Ольга. Мой сын Лёша (10 лет) очень талантлив в математике и программировании. Он выиграл несколько олимпиад. Ему предложили место в специализированной школе для одаренных детей, но обучение платное. Я одна воспитываю двоих детей, работаю учителем. Зарплата маленькая, на такое обучение не хватает. Не хочу, чтобы талант сына пропал. Прошу помочь дать ему шанс на достойное образование и будущее.",
                    amount: 52000,
                    recipient: "Ольга В.",
                    bank: "Открытие",
                    phone: "+7 (990) 123-45-67",
                    image: "image/9.jpg"
                },
                {
                    id: 10,
                    title: "Восстановление после операции",
                    authorName: "Игорь Лебедев",
                    authorFull: "Игорь Лебедев",
                    authorShort: "Игорь Л.",
                    avatar: "avatars/avatar-10.jpg",
                    description: "Меня зовут Игорь, мне 38 лет. Полгода назад перенес сложную операцию на позвоночнике. Операция прошла успешно, но нужна длительная реабилитация - специальные упражнения, массаж, физиотерапия. На лечение ушли все сбережения. Сейчас не могу работать, жена одна содержит семью и двоих детей. Реабилитация необходима, чтобы я смог вернуться к нормальной жизни и работе. Прошу помочь завершить лечение. Хочу снова быть полноценной опорой для своей семьи.",
                    amount: 89000,
                    recipient: "Игорь Л.",
                    bank: "Совкомбанк",
                    phone: "+7 (901) 234-56-78",
                    image: "image/10.jpg"
                }
            ];

            const navItems = document.querySelectorAll('.nav-item');
            const contentSections = document.querySelectorAll('.content-section');

            navItems.forEach(item => {
                item.addEventListener('click', () => {
                    if (item.classList.contains('hidden')) return;
                    
                    const tabId = item.getAttribute('data-tab');
                    
                    navItems.forEach(nav => nav.classList.remove('active'));
                    item.classList.add('active');
                    
                    contentSections.forEach(section => section.classList.remove('active'));
                    document.getElementById(tabId).classList.add('active');

                    if (tabId === 'chats') {
                        renderChatsList();
                    }
                    
                    if (tabId === 'rating') {
                        initializeRating();
                    }
                });
            });

            const photoInput = document.getElementById('photoInput');
            const photoPreview = document.getElementById('photoPreview');

            const savedProfile = getFromLocalStorage('userProfile');
            if (savedProfile) {
                if (savedProfile.photo) {
                    photoPreview.innerHTML = `<img src="${savedProfile.photo}" alt="Preview">`;
                }
                if (savedProfile.firstName) document.getElementById('firstName').value = savedProfile.firstName;
                if (savedProfile.lastName) document.getElementById('lastName').value = savedProfile.lastName;
                if (savedProfile.phone) document.getElementById('phone').value = savedProfile.phone;
            }

            photoInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        photoPreview.innerHTML = `<img src="${event.target.result}" alt="Preview">`;
                        const profile = getFromLocalStorage('userProfile') || {};
                        profile.photo = event.target.result;
                        saveToLocalStorage('userProfile', profile);
                    };
                    reader.readAsDataURL(file);
                }
            });

            const profileForm = document.getElementById('profileForm');
            profileForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = {
                    firstName: document.getElementById('firstName').value,
                    lastName: document.getElementById('lastName').value,
                    phone: document.getElementById('phone').value,
                    password: document.getElementById('password').value,
                    photo: getFromLocalStorage('userProfile')?.photo || null
                };

                saveToLocalStorage('userProfile', formData);
                alert('Профиль сохранен!');
            });

            const phoneInput = document.getElementById('phone');
            phoneInput.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                if (value.length > 0) {
                    if (value[0] !== '7') {
                        value = '7' + value;
                    }
                    let formatted = '+7';
                    if (value.length > 1) {
                        formatted += ' (' + value.substring(1, 4);
                    }
                    if (value.length >= 5) {
                        formatted += ') ' + value.substring(4, 7);
                    }
                    if (value.length >= 8) {
                        formatted += '-' + value.substring(7, 9);
                    }
                    if (value.length >= 10) {
                        formatted += '-' + value.substring(9, 11);
                    }
                    e.target.value = formatted;
                }
            });

            const charityInitial = document.getElementById('charityInitial');
            const introForm = document.getElementById('introForm');
            const postsList = document.getElementById('postsList');
            const postsContainer = document.getElementById('postsContainer');
            const postDetail = document.getElementById('postDetail');

            const wantToHelpBtn = document.getElementById('wantToHelpBtn');
            const needHelpBtn = document.getElementById('needHelpBtn');
            const helperForm = document.getElementById('helperForm');
            const backToButtons = document.getElementById('backToButtons');

            function showHelperTabs() {
                document.querySelector('.nav-item[data-tab="rating"]').classList.remove('hidden');
                document.querySelector('.nav-item[data-tab="chats"]').classList.remove('hidden');
                document.querySelector('.nav-item[data-tab="info"]').classList.remove('hidden');
            }
            
            function showNeedyTabs() {
                document.querySelector('.nav-item[data-tab="chats"]').classList.remove('hidden');
                const emptyChatsDesc = document.getElementById('chatsDescription');
                if (emptyChatsDesc) {
                    emptyChatsDesc.textContent = 'Здесь будут чаты, когда вам пожертвуют';
                }
            }

            const helperName = getFromLocalStorage('helperName');
            if (helperName) {
                charityInitial.style.display = 'none';
                introForm.style.display = 'none';
                postsList.style.display = 'block';
                renderPosts();
                showHelperTabs();
                initializeRating();
            }
            
            const userPost = getFromLocalStorage('userPost');
            const verificationData = getFromLocalStorage('verificationData');
            if (userPost && verificationData && verificationData.status === 'approved') {
                showNeedyTabs();
            }

            wantToHelpBtn.addEventListener('click', () => {
                charityInitial.style.display = 'none';
                introForm.style.display = 'block';
            });

            needHelpBtn.addEventListener('click', () => {
                openVerificationForm();
            });

            // Обработчик кнопки "Реквизиты для помощи"
            const paymentDetailsBtn = document.getElementById('paymentDetailsBtn');
            const paymentModal = document.getElementById('paymentModal');
            const closePaymentModal = document.getElementById('closePaymentModal');
            const qrCodeContainer = document.getElementById('qrCodeContainer');

            // Открытие модального окна
            if (paymentDetailsBtn) {
                paymentDetailsBtn.addEventListener('click', () => {
                    paymentModal.classList.add('active');
                    document.body.style.overflow = 'hidden';
                });
            }

            // Закрытие модального окна
            if (closePaymentModal) {
                closePaymentModal.addEventListener('click', () => {
                    paymentModal.classList.remove('active');
                    document.body.style.overflow = 'auto';
                });
            }

            // Закрытие при клике вне модального окна
            if (paymentModal) {
                paymentModal.addEventListener('click', (e) => {
                    if (e.target === paymentModal) {
                        paymentModal.classList.remove('active');
                        document.body.style.overflow = 'auto';
                    }
                });
            }

            // Обработка загрузки чека
            const receiptFileInput = document.getElementById('receiptFileInput');
            const receiptUploadArea = document.getElementById('receiptUploadArea');
            const receiptFileName = document.getElementById('receiptFileName');
            const submitReceiptBtn = document.getElementById('submitReceiptBtn');
            const receiptProcessingModal = document.getElementById('receiptProcessingModal');
            const closeReceiptProcessingModal = document.getElementById('closeReceiptProcessingModal');

            // Клик на область загрузки
            if (receiptUploadArea && receiptFileInput) {
                receiptUploadArea.addEventListener('click', () => {
                    receiptFileInput.click();
                });

                // Обработка выбора файла
                receiptFileInput.addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        // Проверка размера файла (10 МБ = 10 * 1024 * 1024 байт)
                        const maxSize = 10 * 1024 * 1024;
                        if (file.size > maxSize) {
                            alert('Размер файла превышает 10 МБ. Пожалуйста, выберите файл меньшего размера.');
                            receiptFileInput.value = '';
                            return;
                        }

                        // Проверка формата
                        const allowedTypes = ['image/jpeg', 'image/png', 'image/jpg', 'application/pdf'];
                        if (!allowedTypes.includes(file.type)) {
                            alert('Неподдерживаемый формат файла. Пожалуйста, выберите JPG, PNG или PDF.');
                            receiptFileInput.value = '';
                            return;
                        }

                        // Показываем имя файла
                        receiptFileName.textContent = `Выбран файл: ${file.name}`;
                        receiptFileName.style.display = 'block';
                        
                        // Показываем кнопку отправки
                        submitReceiptBtn.style.display = 'block';
                    }
                });

                // Drag and drop
                receiptUploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    receiptUploadArea.style.borderColor = '#3b82f6';
                    receiptUploadArea.style.background = 'rgba(59, 130, 246, 0.1)';
                });

                receiptUploadArea.addEventListener('dragleave', (e) => {
                    e.preventDefault();
                    receiptUploadArea.style.borderColor = '#334155';
                    receiptUploadArea.style.background = 'transparent';
                });

                receiptUploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    receiptUploadArea.style.borderColor = '#334155';
                    receiptUploadArea.style.background = 'transparent';
                    
                    const file = e.dataTransfer.files[0];
                    if (file) {
                        // Проверка размера
                        const maxSize = 10 * 1024 * 1024;
                        if (file.size > maxSize) {
                            alert('Размер файла превышает 10 МБ. Пожалуйста, выберите файл меньшего размера.');
                            return;
                        }

                        // Проверка формата
                        const allowedTypes = ['image/jpeg', 'image/png', 'image/jpg', 'application/pdf'];
                        if (!allowedTypes.includes(file.type)) {
                            alert('Неподдерживаемый формат файла. Пожалуйста, выберите JPG, PNG или PDF.');
                            return;
                        }

                        // Устанавливаем файл в input
                        const dataTransfer = new DataTransfer();
                        dataTransfer.items.add(file);
                        receiptFileInput.files = dataTransfer.files;

                        // Показываем имя файла
                        receiptFileName.textContent = `Выбран файл: ${file.name}`;
                        receiptFileName.style.display = 'block';
                        
                        // Показываем кнопку отправки
                        submitReceiptBtn.style.display = 'block';
                    }
                });
            }

            // Отправка чека
            if (submitReceiptBtn) {
                submitReceiptBtn.addEventListener('click', () => {
                    const file = receiptFileInput.files[0];
                    if (!file) {
                        alert('Пожалуйста, выберите файл чека');
                        return;
                    }

                    // Закрываем модальное окно с реквизитами
                    paymentModal.classList.remove('active');
                    
                    // Показываем модальное окно обработки
                    receiptProcessingModal.classList.add('active');
                    document.body.style.overflow = 'hidden';
                    
                    // Сбрасываем форму
                    receiptFileInput.value = '';
                    receiptFileName.style.display = 'none';
                    submitReceiptBtn.style.display = 'none';
                });
            }

            // Закрытие модального окна обработки чека
            if (closeReceiptProcessingModal) {
                closeReceiptProcessingModal.addEventListener('click', () => {
                    receiptProcessingModal.classList.remove('active');
                    document.body.style.overflow = 'auto';
                });
            }
            
            function openVerificationForm() {
                const modal = document.createElement('div');
                modal.id = 'verificationModal';
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(10, 14, 39, 0.95);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 1000;
                    padding: 20px;
                    overflow-y: auto;
                `;
                
                modal.innerHTML = `
                    <div style="background: #0f1629; border: 1px solid #1e293b; border-radius: 24px; max-width: 600px; width: 100%; max-height: 90vh; overflow-y: auto; position: relative;">
                        <div style="padding: 32px;">
                            <button id="closeVerification" style="position: absolute; top: 16px; right: 16px; width: 32px; height: 32px; background: transparent; border: 1px solid #334155; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                                <svg style="width: 16px; height: 16px; stroke: #f1f5f9;" viewBox="0 0 24 24" fill="none" stroke-width="2">
                                    <line x1="18" y1="6" x2="6" y2="18"></line>
                                    <line x1="6" y1="6" x2="18" y2="18"></line>
                                </svg>
                            </button>
                            
                            <div style="text-align: center; margin-bottom: 32px;">
                                <h2 style="color: #f1f5f9; font-size: 24px; font-weight: 700; margin-bottom: 8px;">Верификация личности</h2>
                                <p style="color: #64748b; font-size: 14px;">Заполните все данные для подтверждения личности</p>
                            </div>
                            
                            <form id="verificationForm">
                                <div style="margin-bottom: 24px;">
                                    <label style="display: block; color: #f1f5f9; font-size: 14px; font-weight: 500; margin-bottom: 8px;">Фото пользователя</label>
                                    <div style="display: flex; justify-content: center; margin-bottom: 16px;">
                                        <div style="position: relative;">
                                            <div id="userPhotoPreview" style="width: 120px; height: 120px; border-radius: 50%; background: #1e293b; border: 2px solid #334155; display: flex; align-items: center; justify-content: center; overflow: hidden;">
                                                <svg style="width: 48px; height: 48px; stroke: #64748b;" viewBox="0 0 24 24" fill="none" stroke-width="2">
                                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                                    <circle cx="12" cy="7" r="4"></circle>
                                                </svg>
                                            </div>
                                            <label for="userPhoto" style="position: absolute; bottom: 0; right: 0; width: 36px; height: 36px; background: #3b82f6; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer;">
                                                <svg style="width: 18px; height: 18px; stroke: white;" viewBox="0 0 24 24" fill="none" stroke-width="2">
                                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                                    <polyline points="17 8 12 3 7 8"></polyline>
                                                    <line x1="12" y1="3" x2="12" y2="15"></line>
                                                </svg>
                                            </label>
                                            <input type="file" id="userPhoto" accept="image/*" required style="display: none;">
                                        </div>
                                    </div>
                                </div>
                                
                                <div style="margin-bottom: 24px;">
                                    <label style="display: block; color: #f1f5f9; font-size: 14px; font-weight: 500; margin-bottom: 8px;">Фамилия</label>
                                    <input type="text" id="verLastName" required placeholder="Введите фамилию" style="width: 100%; height: 44px; padding: 0 16px; background: rgba(30, 41, 59, 0.5); border: 1px solid #334155; border-radius: 12px; color: #f1f5f9; font-size: 14px;">
                                </div>
                                
                                <div style="margin-bottom: 24px;">
                                    <label style="display: block; color: #f1f5f9; font-size: 14px; font-weight: 500; margin-bottom: 8px;">Имя</label>
                                    <input type="text" id="verFirstName" required placeholder="Введите имя" style="width: 100%; height: 44px; padding: 0 16px; background: rgba(30, 41, 59, 0.5); border: 1px solid #334155; border-radius: 12px; color: #f1f5f9; font-size: 14px;">
                                </div>
                                
                                <div style="margin-bottom: 24px;">
                                    <label style="display: block; color: #f1f5f9; font-size: 14px; font-weight: 500; margin-bottom: 8px;">Отчество (необязательно)</label>
                                    <input type="text" id="verMiddleName" placeholder="Введите отчество" style="width: 100%; height: 44px; padding: 0 16px; background: rgba(30, 41, 59, 0.5); border: 1px solid #334155; border-radius: 12px; color: #f1f5f9; font-size: 14px;">
                                </div>
                                
                                <div style="margin-bottom: 24px;">
                                    <label style="display: block; color: #f1f5f9; font-size: 14px; font-weight: 500; margin-bottom: 8px;">Дата рождения</label>
                                    <input type="date" id="verBirthDate" required style="width: 100%; height: 44px; padding: 0 16px; background: rgba(30, 41, 59, 0.5); border: 1px solid #334155; border-radius: 12px; color: #f1f5f9; font-size: 14px;">
                                </div>
                                
                                <div style="margin-bottom: 24px;">
                                    <label style="display: block; color: #f1f5f9; font-size: 14px; font-weight: 500; margin-bottom: 8px;">Серия и номер паспорта</label>
                                    <div style="display: flex; gap: 12px;">
                                        <input type="text" id="passportSeries" required placeholder="0000" maxlength="4" style="width: 100px; height: 44px; padding: 0 16px; background: rgba(30, 41, 59, 0.5); border: 1px solid #334155; border-radius: 12px; color: #f1f5f9; font-size: 14px;">
                                        <input type="text" id="passportNumber" required placeholder="000000" maxlength="6" style="flex: 1; height: 44px; padding: 0 16px; background: rgba(30, 41, 59, 0.5); border: 1px solid #334155; border-radius: 12px; color: #f1f5f9; font-size: 14px;">
                                    </div>
                                </div>
                                
                                <div style="margin-bottom: 24px;">
                                    <label style="display: block; color: #f1f5f9; font-size: 14px; font-weight: 500; margin-bottom: 8px;">Кем выдан</label>
                                    <input type="text" id="passportIssuer" required placeholder="Например: ОУФМС России по..." style="width: 100%; height: 44px; padding: 0 16px; background: rgba(30, 41, 59, 0.5); border: 1px solid #334155; border-radius: 12px; color: #f1f5f9; font-size: 14px;">
                                </div>
                                
                                <div style="margin-bottom: 24px;">
                                    <label style="display: block; color: #f1f5f9; font-size: 14px; font-weight: 500; margin-bottom: 8px;">Когда выдан</label>
                                    <input type="date" id="passportDate" required style="width: 100%; height: 44px; padding: 0 16px; background: rgba(30, 41, 59, 0.5); border: 1px solid #334155; border-radius: 12px; color: #f1f5f9; font-size: 14px;">
                                </div>
                                
                                <div style="margin-bottom: 24px;">
                                    <label style="display: block; color: #f1f5f9; font-size: 14px; font-weight: 500; margin-bottom: 12px;">ИНН или СНИЛС *</label>
                                    <div style="display: flex; gap: 16px; margin-bottom: 12px;">
                                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                            <input type="radio" name="docType" value="inn" id="docTypeInn" required style="width: 18px; height: 18px; cursor: pointer;">
                                            <span style="color: #f1f5f9; font-size: 14px;">ИНН</span>
                                        </label>
                                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                            <input type="radio" name="docType" value="snils" id="docTypeSnils" required style="width: 18px; height: 18px; cursor: pointer;">
                                            <span style="color: #f1f5f9; font-size: 14px;">СНИЛС</span>
                                        </label>
                                    </div>
                                    <div id="innContainer" style="display: none;">
                                        <input type="text" id="verInn" placeholder="000000000000" maxlength="12" style="width: 100%; height: 44px; padding: 0 16px; background: rgba(30, 41, 59, 0.5); border: 1px solid #334155; border-radius: 12px; color: #f1f5f9; font-size: 14px;">
                                        <p id="innError" style="color: #ef4444; font-size: 12px; margin-top: 4px; display: none;">ИНН должен содержать 12 цифр</p>
                                    </div>
                                    <div id="snilsContainer" style="display: none;">
                                        <input type="text" id="verSnils" placeholder="000-000-000 00" style="width: 100%; height: 44px; padding: 0 16px; background: rgba(30, 41, 59, 0.5); border: 1px solid #334155; border-radius: 12px; color: #f1f5f9; font-size: 14px;">
                                        <p id="snilsError" style="color: #ef4444; font-size: 12px; margin-top: 4px; display: none;">СНИЛС должен содержать 11 цифр</p>
                                    </div>
                                </div>
                                
                                <div style="margin-bottom: 24px;">
                                    <label style="display: block; color: #f1f5f9; font-size: 14px; font-weight: 500; margin-bottom: 12px;">Фото/сканы паспорта</label>
                                    <div style="border: 2px dashed #334155; border-radius: 12px; padding: 24px; text-align: center; cursor: pointer; transition: all 0.2s;" id="passportUploadArea">
                                        <svg style="width: 48px; height: 48px; stroke: #64748b; margin: 0 auto 12px;" viewBox="0 0 24 24" fill="none" stroke-width="2">
                                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                            <polyline points="17 8 12 3 7 8"></polyline>
                                            <line x1="12" y1="3" x2="12" y2="15"></line>
                                        </svg>
                                        <p style="color: #f1f5f9; font-size: 14px; margin-bottom: 4px;">Загрузите фото паспорта</p>
                                        <p style="color: #64748b; font-size: 12px;">Можно загрузить несколько файлов</p>
                                    </div>
                                    <input type="file" id="passportFiles" multiple accept="image/*,.pdf" required style="display: none;">
                                    <div id="passportPreview" style="margin-top: 12px; display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 8px;"></div>
                                </div>
                                
                                <div style="margin-bottom: 24px;">
                                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 12px; background: rgba(30, 41, 59, 0.3); border-radius: 8px; margin-bottom: 8px;">
                                        <input type="checkbox" id="consent1" required style="width: 18px; height: 18px; cursor: pointer;">
                                        <span style="color: #f1f5f9; font-size: 13px;">Я согласен с обработкой персональных данных</span>
                                    </label>
                                    
                                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 12px; background: rgba(30, 41, 59, 0.3); border-radius: 8px; margin-bottom: 8px;">
                                        <input type="checkbox" id="consent2" required style="width: 18px; height: 18px; cursor: pointer;">
                                        <span style="color: #f1f5f9; font-size: 13px;">Я подтверждаю, что это мои данные</span>
                                    </label>
                                    
                                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; padding: 12px; background: rgba(30, 41, 59, 0.3); border-radius: 8px;">
                                        <input type="checkbox" id="consent3" required style="width: 18px; height: 18px; cursor: pointer;">
                                        <span style="color: #f1f5f9; font-size: 13px;">Я подтверждаю, что данные являются настоящими</span>
                                    </label>
                                </div>
                                
                                <button type="submit" style="width: 100%; height: 48px; background: #3b82f6; border: none; border-radius: 12px; color: white; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.2s;">
                                    Отправить на проверку
                                </button>
                            </form>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                document.getElementById('closeVerification').addEventListener('click', () => {
                    modal.remove();
                });
                
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.remove();
                    }
                });
                
                document.getElementById('userPhoto').addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (event) => {
                            document.getElementById('userPhotoPreview').innerHTML = `<img src="${event.target.result}" style="width: 100%; height: 100%; object-fit: cover;">`;
                        };
                        reader.readAsDataURL(file);
                    }
                });
                
                document.getElementById('passportSeries').addEventListener('input', (e) => {
                    e.target.value = e.target.value.replace(/\D/g, '').substring(0, 4);
                });
                
                document.getElementById('passportNumber').addEventListener('input', (e) => {
                    e.target.value = e.target.value.replace(/\D/g, '').substring(0, 6);
                });
                
                const innField = document.getElementById('verInn');
                const snilsField = document.getElementById('verSnils');
                const innError = document.getElementById('innError');
                const snilsError = document.getElementById('snilsError');

                document.getElementById('docTypeInn').addEventListener('change', (e) => {
                    if (e.target.checked) {
                        document.getElementById('innContainer').style.display = 'block';
                        document.getElementById('snilsContainer').style.display = 'none';
                        innField.required = true;
                        snilsField.required = false;
                        snilsField.value = '';
                        snilsField.setCustomValidity('');
                        snilsError.style.display = 'none';
                    }
                });
                
                document.getElementById('docTypeSnils').addEventListener('change', (e) => {
                    if (e.target.checked) {
                        document.getElementById('snilsContainer').style.display = 'block';
                        document.getElementById('innContainer').style.display = 'none';
                        snilsField.required = true;
                        innField.required = false;
                        innField.value = '';
                        innField.setCustomValidity('');
                        innError.style.display = 'none';
                    }
                });
                
                innField.addEventListener('input', (e) => {
                    e.target.value = e.target.value.replace(/\D/g, '').substring(0, 12);
                    if (e.target.value.length > 0 && e.target.value.length !== 12) {
                        innError.style.display = 'block';
                        e.target.setCustomValidity('ИНН должен содержать 12 цифр');
                    } else {
                        innError.style.display = 'none';
                        e.target.setCustomValidity('');
                    }
                });
                
                snilsField.addEventListener('input', (e) => {
                    let value = e.target.value.replace(/\D/g, '');
                    value = value.substring(0, 11);
                    let formatted = '';
                    if (value.length > 0) formatted += value.substring(0, 3);
                    if (value.length > 3) formatted += '-' + value.substring(3, 6);
                    if (value.length > 6) formatted += '-' + value.substring(6, 9);
                    if (value.length > 9) formatted += ' ' + value.substring(9, 11);
                    e.target.value = formatted;
                    
                    if (value.length > 0 && value.length !== 11) {
                        snilsError.style.display = 'block';
                        e.target.setCustomValidity('СНИЛС должен содержать 11 цифр');
                    } else {
                        snilsError.style.display = 'none';
                        e.target.setCustomValidity('');
                    }
                });
                
                const passportUploadArea = document.getElementById('passportUploadArea');
                const passportFiles = document.getElementById('passportFiles');
                const passportPreview = document.getElementById('passportPreview');
                
                passportUploadArea.addEventListener('click', () => {
                    passportFiles.click();
                });
                
                passportFiles.addEventListener('change', (e) => {
                    passportPreview.innerHTML = '';
                    Array.from(e.target.files).forEach((file) => {
                        const reader = new FileReader();
                        reader.onload = (event) => {
                            const img = document.createElement('img');
                            img.src = event.target.result;
                            img.style.cssText = 'width: 100%; height: 100px; object-fit: cover; border-radius: 8px; border: 1px solid #334155;';
                            passportPreview.appendChild(img);
                        };
                        reader.readAsDataURL(file);
                    });
                });
                
                document.getElementById('verificationForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    
                    const docTypeInn = document.getElementById('docTypeInn').checked;
                    const docTypeSnils = document.getElementById('docTypeSnils').checked;
                    
                    if (!docTypeInn && !docTypeSnils) {
                        alert('Пожалуйста, выберите ИНН или СНИЛС');
                        return;
                    }
                    
                    if (docTypeInn) {
                        const innValue = innField.value.replace(/\D/g, '');
                        if (innValue.length !== 12) {
                            innError.style.display = 'block';
                            innField.focus();
                            innField.setCustomValidity('ИНН должен содержать 12 цифр');
                            innField.reportValidity();
                            return;
                        }
                    }
                    
                    if (docTypeSnils) {
                        const snilsDigits = snilsField.value.replace(/\D/g, '');
                        if (snilsDigits.length !== 11) {
                            snilsError.style.display = 'block';
                            snilsField.focus();
                            snilsField.setCustomValidity('СНИЛС должен содержать 11 цифр');
                            snilsField.reportValidity();
                            return;
                        }
                    }
                    
                    const verificationData = {
                        userPhoto: document.getElementById('userPhotoPreview').querySelector('img')?.src,
                        lastName: document.getElementById('verLastName').value,
                        firstName: document.getElementById('verFirstName').value,
                        middleName: document.getElementById('verMiddleName').value,
                        birthDate: document.getElementById('verBirthDate').value,
                        passportSeries: document.getElementById('passportSeries').value,
                        passportNumber: document.getElementById('passportNumber').value,
                        passportIssuer: document.getElementById('passportIssuer').value,
                        passportDate: document.getElementById('passportDate').value,
                        docType: docTypeInn ? 'inn' : 'snils',
                        inn: docTypeInn ? document.getElementById('verInn').value : '',
                        snils: docTypeSnils ? document.getElementById('verSnils').value : '',
                        passportScans: Array.from(document.getElementById('passportPreview').querySelectorAll('img')).map(img => img.src),
                        consent1: document.getElementById('consent1').checked,
                        consent2: document.getElementById('consent2').checked,
                        consent3: document.getElementById('consent3').checked,
                        status: 'pending',
                        submittedAt: new Date().toISOString()
                    };
                    
                    saveToLocalStorage('verificationData', verificationData);
                    modal.remove();
                    showPendingStatus();
                });
            }
            
            function showPendingStatus() {
                const modal = document.createElement('div');
                modal.id = 'pendingModal';
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(10, 14, 39, 0.95);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 1000;
                    padding: 20px;
                `;
                
                modal.innerHTML = `
                    <div style="background: #0f1629; border: 1px solid #1e293b; border-radius: 24px; max-width: 500px; width: 100%; padding: 48px; text-align: center;">
                        <div style="width: 80px; height: 80px; border: 4px solid #334155; border-top-color: #3b82f6; border-radius: 50%; margin: 0 auto 24px; animation: spin 1s linear infinite;"></div>
                        <style>
                            @keyframes spin {
                                to { transform: rotate(360deg); }
                            }
                        </style>
                        <h2 style="color: #f1f5f9; font-size: 24px; font-weight: 700; margin-bottom: 12px;">Ваши данные на рассмотрении</h2>
                        <p style="color: #64748b; font-size: 14px; line-height: 1.6; margin-bottom: 24px;">
                            Мы проверяем ваши документы и данные. Это может занять некоторое время. 
                            Вы получите уведомление, когда проверка будет завершена.
                        </p>
                        <p style="color: #3b82f6; font-size: 13px; font-weight: 600;">Обычно проверка занимает 2-5 минут</p>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.remove();
                    }
                });
                
                setTimeout(() => {
                    const verificationData = getFromLocalStorage('verificationData');
                    verificationData.status = 'approved';
                    saveToLocalStorage('verificationData', verificationData);
                    modal.remove();
                    showPostCreationForm();
                }, 3000);
            }
            
            
            function showPostCreatedSuccess(onComplete) {
                const modal = document.createElement('div');
                modal.id = 'postCreatedModal';
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(10, 14, 39, 0.95);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 1000;
                    padding: 20px;
                `;
                
                modal.innerHTML = `
                    <div style="background: #0f1629; border: 1px solid #1e293b; border-radius: 24px; max-width: 500px; width: 100%; padding: 48px; text-align: center;">
                        <div style="width: 64px; height: 64px; background: rgba(16, 185, 129, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 24px;">
                            <svg style="width: 32px; height: 32px; stroke: #10b981;" viewBox="0 0 24 24" fill="none" stroke-width="2">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                        </div>
                        <h2 style="color: #f1f5f9; font-size: 24px; font-weight: 700; margin-bottom: 12px;">Пост успешно создан!</h2>
                        <p style="color: #64748b; font-size: 14px; line-height: 1.6; margin-bottom: 24px;">
                            Ваш пост создан и готов к просмотру. Теперь другие пользователи смогут увидеть вашу ситуацию и помочь вам.
                        </p>
                        <button id="closePostCreatedModal" style="width: 100%; height: 48px; background: #3b82f6; border: none; border-radius: 12px; color: white; font-size: 16px; font-weight: 600; cursor: pointer; margin-top: 8px;">
                            Понятно
                        </button>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                const closeBtn = document.getElementById('closePostCreatedModal');
                closeBtn.addEventListener('click', () => {
                    modal.remove();
                    if (onComplete) {
                        onComplete();
                    }
                });
                
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.remove();
                        if (onComplete) {
                            onComplete();
                        }
                    }
                });
            }

            helperForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const name = document.getElementById('helperName').value;
                saveToLocalStorage('helperName', name);
                
                introForm.style.display = 'none';
                postsList.style.display = 'block';
                renderPosts();
                
                showHelperTabs();
            });


            // Функция для генерации уникального 5-значного ID
            function generatePostId(postId) {
                // Генерируем уникальный 5-значный номер на основе id поста
                // Используем формулу для получения чисел от 10000 до 99999
                const base = 10000;
                const multiplier = 1237; // Простое число для более случайного вида
                const uniqueId = base + ((postId * multiplier) % 90000);
                return String(uniqueId).padStart(5, '0');
            }

            function renderPosts() {
                postsContainer.innerHTML = '';
                charityPosts.forEach(post => {
                    const postCard = document.createElement('div');
                    postCard.className = 'post-card';
                    const uniqueId = generatePostId(post.id);
                    postCard.innerHTML = `
                        <img src="${post.image}" alt="${post.title}" class="post-image">
                        <div class="post-content">
                            <div class="post-author">
                                <img src="${post.avatar}" alt="${post.authorName}" class="post-avatar">
                                <div class="post-author-info">
                                    <div class="post-author-name">${post.authorName}</div>
                                </div>
                            </div>
                            <h3 class="post-title">${post.title}</h3>
                            <div class="post-amount" style="--progress-width: ${((post.collected || 0) / post.amount * 100)}%">
                                <div class="post-amount-content">
                                    <span class="post-amount-collected">${(post.collected || 0).toLocaleString('ru-RU')}<span class="post-amount-currency">₽</span></span>
                                    <span class="post-amount-target">${post.amount.toLocaleString('ru-RU')}<span class="post-amount-currency">₽</span></span>
                                </div>
                            </div>
                        </div>
                        <div class="post-id">ID: ${uniqueId}</div>
                    `;
                    postCard.addEventListener('click', () => openPostDetail(post));
                    postsContainer.appendChild(postCard);
                });
            }

            function openPostDetail(post) {
                currentPost = post;
                document.getElementById('detailImage').src = post.image;
                document.getElementById('detailAuthorAvatar').src = post.avatar;
                document.getElementById('detailAuthorName').textContent = post.authorName;
                document.getElementById('detailTitle').textContent = post.title;
                document.getElementById('detailDescription').textContent = post.description;
                const collected = post.collected || 0;
                const progress = post.amount > 0 ? (collected / post.amount * 100) : 0;
                const detailAmountEl = document.getElementById('detailAmount');
                detailAmountEl.style.setProperty('--progress-width', `${progress}%`);
                detailAmountEl.innerHTML = `
                    <div class="amount-display-content">
                        <span class="amount-display-collected">${collected.toLocaleString('ru-RU')}<span class="amount-display-currency">₽</span></span>
                        <span class="amount-display-target">${post.amount.toLocaleString('ru-RU')}<span class="amount-display-currency">₽</span></span>
                    </div>
                `;
                const uniqueId = generatePostId(post.id);
                document.getElementById('detailPostId').textContent = `ID: ${uniqueId}`;
                
                postDetail.classList.add('active');
                document.body.style.overflow = 'hidden';
            }

            document.getElementById('closeDetail').addEventListener('click', () => {
                postDetail.classList.remove('active');
                document.body.style.overflow = 'auto';
                currentPost = null;
            });

            postDetail.addEventListener('click', (e) => {
                if (e.target === postDetail) {
                    postDetail.classList.remove('active');
                    document.body.style.overflow = 'auto';
                    currentPost = null;
                }
            });



            const chatsList = document.getElementById('chatsList');
            const emptyChats = document.getElementById('emptyChats');
            const closeChat = document.getElementById('closeChat');
            const chatMessages = document.getElementById('chatMessages');
            const chatInput = document.getElementById('chatInput');
            const sendMessage = document.getElementById('sendMessage');
            const chatAttachment = document.getElementById('chatAttachment');
            const emojiButtons = document.querySelectorAll('.emoji-btn');
            let pendingAttachment = null;
            let currentPost = null;
            let currentChatPost = null;

            const formatChatDate = (date) => {
                const today = new Date();
                const messageDate = new Date(date);
                
                today.setHours(0, 0, 0, 0);
                messageDate.setHours(0, 0, 0, 0);
                
                const diffTime = today - messageDate;
                const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
                
                if (diffDays === 0) {
                    return 'Сегодня';
                } else if (diffDays === 1) {
                    return 'Вчера';
                } else {
                    return messageDate.toLocaleDateString('ru-RU', { day: 'numeric', month: 'long' });
                }
            };

            const formatMessageTime = (date) => {
                return new Date(date).toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });
            };

            const hasUnreadMessages = () => {
                const chats = getFromLocalStorage('activeChats') || [];
                for (const chat of chats) {
                    const messages = getFromLocalStorage(`chat_${chat.postId}`) || [];
                    const unreadCount = messages.filter(m => !m.isOwn && !m.read).length;
                    if (unreadCount > 0) return true;
                }
                return false;
            };

            const updateNotificationBadge = () => {
                const badge = document.getElementById('chatsNotificationBadge');
                if (hasUnreadMessages()) {
                    badge.style.display = 'block';
                } else {
                    badge.style.display = 'none';
                }
            };
            
            const renderChatsList = () => {
                const chats = getFromLocalStorage('activeChats') || [];
                chatsList.innerHTML = '';
                
                if (chats.length === 0) {
                    emptyChats.style.display = 'block';
                    chatsList.style.display = 'none';
                } else {
                    emptyChats.style.display = 'none';
                    chatsList.style.display = 'flex';
                    
                    chats.forEach(chat => {
                        const post = charityPosts.find(p => p.id === chat.postId);
                        if (!post) return;
                        
                        const messages = getFromLocalStorage(`chat_${post.id}`) || [];
                        const unreadCount = messages.filter(m => !m.isOwn && !m.read).length;
                        
                        let lastMessageText = 'Начните диалог';
                        if (messages.length > 0) {
                            const lastMsg = messages[messages.length - 1];
                            if (lastMsg.text) {
                                lastMessageText = lastMsg.text.length > 50 ? lastMsg.text.substring(0, 50) + '...' : lastMsg.text;
                            } else if (lastMsg.attachment) {
                                lastMessageText = 'Изображение';
                            }
                        }
                        
                        const chatItem = document.createElement('div');
                        chatItem.className = 'chat-item';
                        chatItem.innerHTML = `
                            <img src="${post.avatar}" alt="" class="chat-item-avatar">
                            <div class="chat-item-info">
                                <div class="chat-item-name">${post.authorName}</div>
                                <div class="chat-item-last-message">${lastMessageText}</div>
                            </div>
                            ${unreadCount > 0 ? '<span class="chat-item-notification"></span>' : ''}
                        `;
                        
                        chatItem.addEventListener('click', () => {
                            openChatInTab(post);
                        });
                        
                        chatsList.appendChild(chatItem);
                    });
                }
                
                updateNotificationBadge();
            }

            function openChatInTab(post) {
                currentChatPost = post;
                
                document.getElementById('chatsListView').classList.add('hidden');
                document.getElementById('chatView').classList.add('active');
                
                document.getElementById('chatRecipientAvatar').src = post.avatar;
                document.getElementById('chatRecipientName').textContent = post.authorName;
                
                renderMessages(post.id);
                
                // Mark messages as read
                const messages = getFromLocalStorage(`chat_${post.id}`) || [];
                messages.forEach(m => {
                    if (!m.isOwn) m.read = true;
                });
                saveToLocalStorage(`chat_${post.id}`, messages);
                updateNotificationBadge();
            }

            document.getElementById('chatBackBtn').addEventListener('click', () => {
                document.getElementById('chatView').classList.remove('active');
                document.getElementById('chatsListView').classList.remove('hidden');
                renderChatsList();
            });

            function renderMessages(postId) {
                const messages = getFromLocalStorage(`chat_${postId}`) || [];
                chatMessages.innerHTML = '';
                
                let lastDate = null;
                
                messages.forEach((msg, index) => {
                    const messageDate = formatChatDate(msg.timestamp);
                    
                    if (messageDate !== lastDate) {
                        const dateSeparator = document.createElement('div');
                        dateSeparator.className = 'chat-date-separator';
                        dateSeparator.innerHTML = `<span class="chat-date-text">${messageDate}</span>`;
                        chatMessages.appendChild(dateSeparator);
                        lastDate = messageDate;
                    }
                    
                    const messageDiv = document.createElement('div');
                    messageDiv.className = `chat-message ${msg.isOwn ? 'own' : ''}`;
                    
                    const post = charityPosts.find(p => p.id === postId);
                    const avatarSrc = msg.isOwn ? (getFromLocalStorage('userProfile')?.photo || '/placeholder.svg') : post.avatar;
                    
                    let messageContent = `
                        <img src="${avatarSrc}" alt="" class="message-avatar">
                        <div>
                            <div class="message-bubble">
                                <div class="message-text">${msg.text || ''}</div>
                                ${msg.attachment ? `<img src="${msg.attachment}" class="message-attachment">` : ''}
                                <div class="message-time">${formatMessageTime(msg.timestamp)}${msg.edited ? ' (ред.)' : ''}</div>
                            </div>
                            ${msg.isOwn ? `
                            <div class="message-actions">
                                <button class="message-edit-btn" onclick="editMessage(${postId}, ${index})">Редактировать</button>
                            </div>
                            ` : ''}
                        </div>
                    `;
                    
                    messageDiv.innerHTML = messageContent;
                    chatMessages.appendChild(messageDiv);
                });
                
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }

            window.editMessage = function(postId, messageIndex) {
                const messages = getFromLocalStorage(`chat_${postId}`) || [];
                const message = messages[messageIndex];
                
                if (!message.isOwn) return;
                
                const newText = prompt('Редактировать сообщение:', message.text);
                if (newText !== null && newText.trim() !== '') {
                    message.text = newText.trim();
                    message.edited = true;
                    saveToLocalStorage(`chat_${postId}`, messages);
                    renderMessages(postId);
                }
            };

            function sendChatMessage() {
                if (!currentChatPost) return;
                
                const input = chatInput;
                const text = input.value.trim();
                
                if (text || pendingAttachment) {
                    const messages = getFromLocalStorage(`chat_${currentChatPost.id}`) || [];
                    messages.push({
                        text: text,
                        attachment: pendingAttachment,
                        isOwn: true,
                        timestamp: new Date().toISOString(),
                        read: true,
                        edited: false
                    });
                    saveToLocalStorage(`chat_${currentChatPost.id}`, messages);
                    
                    input.value = '';
                    pendingAttachment = null; // Clear pending attachment
                    renderMessages(currentChatPost.id);
                }
            }
            
            document.getElementById('sendMessage').addEventListener('click', sendChatMessage);
            
            // Send message on Enter key
            chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendChatMessage();
                }
            });

            chatAttachment.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        pendingAttachment = event.target.result;
                        // Optionally display a preview or confirmation here
                        console.log("Attachment ready to send.");
                    };
                    reader.readAsDataURL(file);
                }
            });

            emojiButtons.forEach(button => {
                button.addEventListener('click', () => {
                    chatInput.value += button.dataset.emoji;
                });
            });

            function showPostDetail(postId) {
                const post = charityPosts.find(p => p.id === postId);
                if (!post) return;
                
                currentPost = post;
                document.getElementById('detailImage').src = post.image;
                document.getElementById('detailAuthorAvatar').src = post.avatar;
                document.getElementById('detailAuthorName').textContent = post.authorName;
                document.getElementById('detailTitle').textContent = post.title;
                document.getElementById('detailDescription').textContent = post.description;
                const collected = post.collected || 0;
                const progress = post.amount > 0 ? (collected / post.amount * 100) : 0;
                const detailAmountEl = document.getElementById('detailAmount');
                detailAmountEl.style.setProperty('--progress-width', `${progress}%`);
                detailAmountEl.innerHTML = `
                    <div class="amount-display-content">
                        <span class="amount-display-collected">${collected.toLocaleString('ru-RU')}<span class="amount-display-currency">₽</span></span>
                        <span class="amount-display-target">${post.amount.toLocaleString('ru-RU')}<span class="amount-display-currency">₽</span></span>
                    </div>
                `;
                const uniqueId = generatePostId(post.id);
                document.getElementById('detailPostId').textContent = `ID: ${uniqueId}`;
                
                postDetail.classList.add('active');
                document.body.style.overflow = 'hidden';
            }


            // Update notification badge on page load
            updateNotificationBadge();

            // Render initial chats list if 'chats' tab is active on load
            if (document.getElementById('chats').classList.contains('active')) {
                renderChatsList();
            }

            // Rating functions
            function initializeRating() {
                // Get user data
                const helperName = getFromLocalStorage('helperName');
                const verificationData = getFromLocalStorage('verificationData');
                
                // Generate user rating (for demo, random values)
                const verificationFirst = verificationData?.firstName || '';
                const verificationLast = verificationData?.lastName || '';
                const verificationShort = verificationLast ? `${verificationLast.charAt(0)}.` : '';
                const verificationDisplayName = verificationFirst ? `${verificationFirst}${verificationShort ? ` ${verificationShort}` : ''}` : '';
                const currentUserName = helperName || verificationDisplayName || 'Гость';
                
                const userRating = {
                    name: currentUserName,
                    points: Math.floor(Math.random() * 7000),
                    donated: Math.floor(Math.random() * 70000),
                    avatar: verificationData?.userPhoto || null,
                    isCurrentUser: true
                };
                
                const leaderboard = generateLeaderboard();
                const existingUserIndex = leaderboard.findIndex(u => u.name === userRating.name);
                if (existingUserIndex === -1) {
                    leaderboard.push({
                        id: 'current-user',
                        name: userRating.name,
                        points: userRating.points,
                        status: getStatusByPoints(userRating.points),
                        avatar: userRating.avatar,
                        isCurrentUser: true
                    });
                } else {
                    leaderboard[existingUserIndex].points = userRating.points;
                    leaderboard[existingUserIndex].status = getStatusByPoints(userRating.points);
                    leaderboard[existingUserIndex].avatar = userRating.avatar;
                    leaderboard[existingUserIndex].isCurrentUser = true;
                }
                
                saveToLocalStorage('leaderboard', leaderboard);
                
                leaderboard.sort((a, b) => b.points - a.points);
                const userPosition = leaderboard.findIndex(u => u.isCurrentUser === true) + 1;
                
                updateUserRatingCard(userRating, userPosition);
                renderLeaderboard(leaderboard, userRating.name);
            }

            function generateLeaderboard() {
                const firstNames = ['Александр', 'Мария', 'Дмитрий', 'Елена', 'Иван', 'Анна', 'Сергей', 'Ольга', 'Андрей', 'Татьяна', 
                    'Михаил', 'Наталья', 'Владимир', 'Екатерина', 'Алексей', 'Ирина', 'Николай', 'Светлана', 'Павел', 'Виктория',
                    'Роман', 'Юлия', 'Евгений', 'Марина', 'Артем', 'Кристина', 'Максим', 'Дарья', 'Игорь', 'Валентина',
                    'Станислав', 'Людмила', 'Виктор', 'Галина', 'Денис', 'Вера', 'Антон', 'Надежда', 'Илья', 'Любовь',
                    'Кирилл', 'Оксана', 'Олег', 'Инна', 'Петр', 'Лариса', 'Георгий', 'Зинаида', 'Тимур', 'Алина'];
                
                const lastNames = ['Иванов', 'Петров', 'Сидоров', 'Смирнов', 'Кузнецов', 'Попов', 'Соколов', 'Лебедев', 'Козлов', 'Новиков',
                    'Морозов', 'Волков', 'Соловьев', 'Васильев', 'Зайцев', 'Павлов', 'Семенов', 'Голубев', 'Виноградов', 'Богданов',
                    'Воробьев', 'Федоров', 'Михайлов', 'Беляев', 'Тарасов', 'Белов', 'Комаров', 'Орлов', 'Киселев', 'Макаров',
                    'Андреев', 'Ковалев', 'Ильин', 'Гусев', 'Титов', 'Кузьмин', 'Кудрявцев', 'Баранов', 'Куликов', 'Алексеев',
                    'Степанов', 'Яковлев', 'Сорокин', 'Сергеев', 'Романов', 'Захаров', 'Борисов', 'Королев', 'Герасимов', 'Пономарев'];
                
                const users = [];
                
                for (let i = 0; i < 50; i++) {
                    const firstName = firstNames[Math.floor(Math.random() * firstNames.length)];
                    const lastName = lastNames[Math.floor(Math.random() * lastNames.length)];
                    
                    // Some users have 0 points, others have random points
                    const hasPoints = Math.random() > 0.2; // 80% have points
                    const points = hasPoints ? Math.floor(Math.random() * 10000) : 0;
                    
                    users.push({
                        id: i + 1,
                        name: `${firstName} ${lastName.charAt(0)}.`,
                        points: points,
                        status: getStatusByPoints(points)
                    });
                }
                
                return users;
            }

            function getStatusByPoints(points) {
                if (points === 0) return null;
                if (points >= 5501) return 'Пламенное Сердце';
                if (points >= 2501) return 'Благотворитель';
                if (points >= 501) return 'Хранитель Надежды';
                if (points >= 5) return 'Друг Платформы';
                return null;
            }

            function updateUserRatingCard(userRating, position) {
                document.getElementById('userRatingName').textContent = userRating.name;
                document.getElementById('userTotalPoints').textContent = userRating.points.toLocaleString('ru-RU');
                document.getElementById('userRankPosition').textContent = position > 0 ? position : '—';
                document.getElementById('userTotalDonated').textContent = `${userRating.donated.toLocaleString('ru-RU')} ₽`;
                
                const status = getStatusByPoints(userRating.points);
                document.getElementById('userRatingStatus').textContent = status || 'Начните помогать, чтобы получить статус';
                
                // Update avatar
                const avatarElement = document.querySelector('#userRatingCard .user-rating-avatar');
                if (avatarElement) {
                    if (userRating.avatar) {
                        avatarElement.innerHTML = `<img src="${userRating.avatar}" style="width: 100%; height: 100%; object-fit: cover;" alt="${userRating.name}">`;
                    } else {
                        avatarElement.innerHTML = `<svg viewBox="0 0 24 24" stroke="#64748b" stroke-width="2" fill="none">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>`;
                    }
                }
                
                // Show badge if in top 3
                const rankBadge = document.getElementById('userRankBadge');
                if (position <= 3 && position > 0) {
                    rankBadge.style.display = 'flex';
                    rankBadge.textContent = position;
                    rankBadge.className = 'rank-badge rank-' + position;
                    } else {
                    rankBadge.style.display = 'none';
                }
            }

            function renderLeaderboard(leaderboard, currentUserName) {
                const list = document.getElementById('leaderboardList');
                if (!list) return;
                
                // Sort by points
                leaderboard.sort((a, b) => b.points - a.points);
                
                list.innerHTML = leaderboard.map((user, index) => {
                    const position = index + 1;
                    let rankBadge = '';
                    const isCurrentUser = user.isCurrentUser === true || user.name === currentUserName;
                    
                    if (position <= 3) {
                        rankBadge = `<div class="rank-badge rank-${position}">${position}</div>`;
                    }
                    
                    // Avatar HTML - use image if available, otherwise SVG
                    let avatarHTML = '';
                    if (user.avatar) {
                        avatarHTML = `<img src="${user.avatar}" style="width: 100%; height: 100%; object-fit: cover;" alt="${user.name}">`;
                    } else {
                        avatarHTML = `<svg viewBox="0 0 24 24" fill="none" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>`;
                    }
                    
                    return `
                        <div class="leaderboard-item ${isCurrentUser ? 'current-user' : ''}">
                            <div class="leaderboard-position">${position}</div>
                            ${rankBadge}
                            <div class="leaderboard-avatar">
                                ${avatarHTML}
                            </div>
                            <div class="leaderboard-info">
                                <div class="leaderboard-name">${user.name}</div>
                                <div class="leaderboard-status">${user.status || 'Новый пользователь'}</div>
                            </div>
                            <div class="leaderboard-points">${user.points.toLocaleString('ru-RU')}</div>
                    </div>
                `;
                }).join('');
            }
            
            function showPostCreationForm() {
                const modal = document.createElement('div');
                modal.id = 'postCreationModal';
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(10, 14, 39, 0.95);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 1000;
                    padding: 20px;
                    overflow-y: auto;
                `;
                
                modal.innerHTML = `
                    <div style="background: #0f1629; border: 1px solid #1e293b; border-radius: 24px; max-width: 700px; width: 100%; max-height: 90vh; overflow-y: auto; position: relative;">
                        <div style="padding: 32px;">
                            <button id="closePostCreation" style="position: absolute; top: 16px; right: 16px; width: 32px; height: 32px; background: transparent; border: 1px solid #334155; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                                <svg style="width: 16px; height: 16px; stroke: #f1f5f9;" viewBox="0 0 24 24" fill="none" stroke-width="2">
                                    <line x1="18" y1="6" x2="6" y2="18"></line>
                                    <line x1="6" y1="6" x2="18" y2="18"></line>
                                </svg>
                            </button>
                            
                            <div style="text-align: center; margin-bottom: 32px;">
                                <div style="width: 64px; height: 64px; background: rgba(16, 185, 129, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 16px;">
                                    <svg style="width: 32px; height: 32px; stroke: #10b981;" viewBox="0 0 24 24" fill="none" stroke-width="2">
                                        <polyline points="20 6 9 17 4 12"></polyline>
                                    </svg>
                                </div>
                                <h2 style="color: #f1f5f9; font-size: 24px; font-weight: 700; margin-bottom: 8px;">Верификация пройдена!</h2>
                                <p style="color: #64748b; font-size: 14px;">Теперь создайте пост о вашей ситуации</p>
                            </div>
                            
                            <form id="postCreationForm">
                                <div id="formErrors" style="margin-bottom: 16px;">
                                    <p id="avatarError" style="color: #ef4444; font-size: 12px; margin-top: 4px; margin-bottom: 8px; display: none;">⚠️ Необходимо загрузить фото пользователя в форме верификации</p>
                                    <p id="ageError" style="color: #ef4444; font-size: 12px; margin-top: 4px; margin-bottom: 8px; display: none;">⚠️ Вам должно быть не менее 18 лет для создания поста</p>
                                </div>
                                <div style="margin-bottom: 24px;">
                                    <label style="display: block; color: #f1f5f9; font-size: 14px; font-weight: 500; margin-bottom: 12px;">Фото/видео *</label>
                                    <div style="border: 2px dashed #334155; border-radius: 12px; padding: 32px; text-align: center; cursor: pointer;" id="mediaUploadArea">
                                        <svg style="width: 48px; height: 48px; stroke: #64748b; margin: 0 auto 12px;" viewBox="0 0 24 24" fill="none" stroke-width="2">
                                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                            <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                            <polyline points="21 15 16 10 5 21"></polyline>
                                        </svg>
                                        <p style="color: #f1f5f9; font-size: 14px; margin-bottom: 4px;">Загрузите медиа</p>
                                        <p style="color: #64748b; font-size: 12px;">Можно загрузить до 3 фото или видео</p>
                                    </div>
                                    <input type="file" id="postMedia" accept="image/*,video/*" multiple style="display: none;">
                                    <div id="mediaPreview" style="margin-top: 12px; display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 12px;"></div>
                                    <p id="mediaCount" style="color: #64748b; font-size: 12px; margin-top: 8px; text-align: center;">Загружено: 0 / 3</p>
                                    <p id="mediaError" style="color: #ef4444; font-size: 12px; margin-top: 4px; display: none;">⚠️ Необходимо загрузить хотя бы одно фото или видео</p>
                                </div>
                                
                                <div style="margin-bottom: 24px;">
                                    <label style="display: block; color: #f1f5f9; font-size: 14px; font-weight: 500; margin-bottom: 8px;">Название *</label>
                                    <input type="text" id="postTitle" required placeholder="Краткое название вашей ситуации" style="width: 100%; height: 44px; padding: 0 16px; background: rgba(30, 41, 59, 0.5); border: 1px solid #334155; border-radius: 12px; color: #f1f5f9; font-size: 14px;">
                                    <p id="titleError" style="color: #ef4444; font-size: 12px; margin-top: 4px; display: none;">⚠️ Поле не заполнено или название должно начинаться с большой буквы</p>
                                </div>
                                
                                <div style="margin-bottom: 24px;">
                                    <label style="display: block; color: #f1f5f9; font-size: 14px; font-weight: 500; margin-bottom: 8px;">Описание *</label>
                                    <textarea id="postDescription" required placeholder="Подробно опишите вашу ситуацию..." maxlength="10000" style="width: 100%; min-height: 200px; padding: 12px 16px; background: rgba(30, 41, 59, 0.5); border: 1px solid #334155; border-radius: 12px; color: #f1f5f9; font-size: 14px; resize: vertical; font-family: inherit;"></textarea>
                                    <p style="color: #64748b; font-size: 12px; text-align: right; margin-top: 4px;"><span id="charCount">0</span> / 10 000</p>
                                    <p id="descriptionError" style="color: #ef4444; font-size: 12px; margin-top: 4px; display: none;">⚠️ Поле не заполнено или описание должно содержать минимум 50 символов и начинаться с большой буквы</p>
                                </div>
                                
                                <div style="margin-bottom: 24px;">
                                    <label style="display: block; color: #f1f5f9; font-size: 14px; font-weight: 500; margin-bottom: 8px;">Реквизиты для получения помощи *</label>
                                    
                                    <div style="margin-bottom: 16px;">
                                        <label style="display: block; color: #94a3b8; font-size: 13px; margin-bottom: 4px;">Банк</label>
                                        <input type="text" id="postBank" required placeholder="Название банка" style="width: 100%; height: 44px; padding: 0 16px; background: rgba(30, 41, 59, 0.5); border: 1px solid #334155; border-radius: 12px; color: #f1f5f9; font-size: 14px;">
                                        <p id="bankError" style="color: #ef4444; font-size: 12px; margin-top: 4px; display: none;">⚠️ Поле не заполнено или название банка должно начинаться с большой буквы</p>
                                    </div>
                                    
                                    <div style="margin-bottom: 16px;">
                                        <label style="display: block; color: #94a3b8; font-size: 13px; margin-bottom: 4px;">Номер телефона</label>
                                        <input type="tel" id="postPhone" required placeholder="+7 (___) ___-__-__" style="width: 100%; height: 44px; padding: 0 16px; background: rgba(30, 41, 59, 0.5); border: 1px solid #334155; border-radius: 12px; color: #f1f5f9; font-size: 14px;">
                                        <p id="phoneError" style="color: #ef4444; font-size: 12px; margin-top: 4px; display: none;">⚠️ Поле не заполнено или введите корректный номер телефона</p>
                                    </div>
                                </div>
                                
                                <div style="margin-bottom: 24px;">
                                    <label style="display: block; color: #f1f5f9; font-size: 14px; font-weight: 500; margin-bottom: 8px;">Необходимая сумма (₽) *</label>
                                    <input type="number" id="postAmount" required placeholder="0" min="1" style="width: 100%; height: 44px; padding: 0 16px; background: rgba(30, 41, 59, 0.5); border: 1px solid #334155; border-radius: 12px; color: #f1f5f9; font-size: 14px; -moz-appearance: textfield;">
                                    <style>
                                        #postAmount::-webkit-outer-spin-button,
                                        #postAmount::-webkit-inner-spin-button {
                                            -webkit-appearance: none;
                                            margin: 0;
                                        }
                                    </style>
                                    <p style="color: #ef4444; font-size: 12px; margin-top: 4px;">⚠️ Сумму сбора нельзя будет изменить после создания</p>
                                    <p id="amountError" style="color: #ef4444; font-size: 12px; margin-top: 4px; display: none;">⚠️ Поле не заполнено или сумма должна быть положительным числом</p>
                                </div>
                                
                                <button type="submit" style="width: 100%; height: 48px; background: #3b82f6; border: none; border-radius: 12px; color: white; font-size: 16px; font-weight: 600; cursor: pointer;">
                                    Создать пост
                                </button>
                            </form>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                // Close button
                document.getElementById('closePostCreation').addEventListener('click', () => {
                    modal.remove();
                });
                
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.remove();
                    }
                });
                
                // Media upload
                const mediaUploadArea = document.getElementById('mediaUploadArea');
                const postMedia = document.getElementById('postMedia');
                const mediaPreview = document.getElementById('mediaPreview');
                
                mediaUploadArea.addEventListener('click', () => {
                    postMedia.click();
                });
                
                postMedia.addEventListener('change', (e) => {
                    const files = Array.from(e.target.files).slice(0, 3); // Ограничиваем до 3 файлов
                    if (files.length === 0) return;
                    
                    if (files.length > 3) {
                        alert('Можно загрузить максимум 3 файла');
                        return;
                    }
                    
                    mediaPreview.innerHTML = '';
                    const mediaCountEl = document.getElementById('mediaCount');
                    
                    files.forEach((file, index) => {
                        const reader = new FileReader();
                        reader.onload = (event) => {
                            const mediaWrapper = document.createElement('div');
                            mediaWrapper.style.cssText = 'position: relative; border-radius: 12px; overflow: hidden; border: 1px solid #334155;';
                            
                            if (file.type.startsWith('image/')) {
                                mediaWrapper.innerHTML = `
                                    <img src="${event.target.result}" style="width: 100%; height: 150px; object-fit: cover; display: block;">
                                    <button type="button" class="remove-media-btn" data-index="${index}" style="position: absolute; top: 8px; right: 8px; width: 28px; height: 28px; background: rgba(239, 68, 68, 0.9); border: none; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; color: white; font-size: 18px; font-weight: bold;">×</button>
                                `;
                            } else if (file.type.startsWith('video/')) {
                                mediaWrapper.innerHTML = `
                                    <video src="${event.target.result}" style="width: 100%; height: 150px; object-fit: cover; display: block;" controls></video>
                                    <button type="button" class="remove-media-btn" data-index="${index}" style="position: absolute; top: 8px; right: 8px; width: 28px; height: 28px; background: rgba(239, 68, 68, 0.9); border: none; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; color: white; font-size: 18px; font-weight: bold;">×</button>
                                `;
                            }
                            
                            mediaPreview.appendChild(mediaWrapper);
                            
                            // Обновляем счетчик
                            const currentCount = mediaPreview.children.length;
                            mediaCountEl.textContent = `Загружено: ${currentCount} / 3`;
                            
                            // Скрываем ошибку медиа, если файлы загружены
                            if (currentCount > 0) {
                                document.getElementById('mediaError').style.display = 'none';
                                document.getElementById('mediaUploadArea').style.borderColor = '#334155';
                            }
                            
                            // Обработчик удаления медиа
                            const removeBtn = mediaWrapper.querySelector('.remove-media-btn');
                            removeBtn.addEventListener('click', () => {
                                mediaWrapper.remove();
                                const newCount = mediaPreview.children.length;
                                mediaCountEl.textContent = `Загружено: ${newCount} / 3`;
                                
                                // Обновляем input files
                                const dt = new DataTransfer();
                                Array.from(postMedia.files).forEach((f, i) => {
                                    if (i !== index) dt.items.add(f);
                                });
                                postMedia.files = dt.files;
                            });
                        };
                        reader.readAsDataURL(file);
                    });
                });
                
                // Character counter
                document.getElementById('postDescription').addEventListener('input', (e) => {
                    document.getElementById('charCount').textContent = e.target.value.length.toLocaleString('ru-RU');
                });
                
                // Phone formatting
                document.getElementById('postPhone').addEventListener('input', function(e) {
                    let value = e.target.value.replace(/\D/g, '');
                    if (value.length > 0) {
                        if (value[0] !== '7') {
                            value = '7' + value;
                        }
                        let formatted = '+7';
                        if (value.length > 1) {
                            formatted += ' (' + value.substring(1, 4);
                        }
                        if (value.length >= 5) {
                            formatted += ') ' + value.substring(4, 7);
                        }
                        if (value.length >= 8) {
                            formatted += '-' + value.substring(7, 9);
                        }
                        if (value.length >= 10) {
                            formatted += '-' + value.substring(9, 11);
                        }
                        e.target.value = formatted;
                    }
                });
                
                // Validation functions
                function validateTitle(title) {
                    if (!title || title.trim().length === 0) {
                        return { valid: false, message: 'Поле не заполнено' };
                    }
                    if (!/^[А-ЯЁA-Z]/.test(title.trim())) {
                        return { valid: false, message: 'Название должно начинаться с большой буквы' };
                    }
                    if (/^\d+$/.test(title.trim())) {
                        return { valid: false, message: 'Название не может состоять только из цифр' };
                    }
                    return { valid: true };
                }
                
                function validateDescription(description) {
                    if (!description || description.trim().length === 0) {
                        return { valid: false, message: 'Поле не заполнено' };
                    }
                    if (!/^[А-ЯЁA-Z]/.test(description.trim())) {
                        return { valid: false, message: 'Описание должно начинаться с большой буквы' };
                    }
                    if (description.trim().length < 50) {
                        return { valid: false, message: 'Описание должно содержать минимум 50 символов' };
                    }
                    return { valid: true };
                }
                
                function validateBank(bank) {
                    if (!bank || bank.trim().length === 0) {
                        return { valid: false, message: 'Поле не заполнено' };
                    }
                    if (!/^[А-ЯЁA-Z]/.test(bank.trim())) {
                        return { valid: false, message: 'Название банка должно начинаться с большой буквы' };
                    }
                    return { valid: true };
                }
                
                function validatePhone(phone) {
                    if (!phone || phone.trim().length === 0) {
                        return { valid: false, message: 'Поле не заполнено' };
                    }
                    const digits = phone.replace(/\D/g, '');
                    if (digits.length !== 11 || !digits.startsWith('7')) {
                        return { valid: false, message: 'Введите корректный номер телефона' };
                    }
                    return { valid: true };
                }
                
                function validateAmount(amount) {
                    if (!amount || amount.toString().trim().length === 0) {
                        return { valid: false, message: 'Поле не заполнено' };
                    }
                    const num = parseInt(amount);
                    if (isNaN(num) || num <= 0) {
                        return { valid: false, message: 'Сумма должна быть положительным числом' };
                    }
                    return { valid: true };
                }
                
                document.getElementById('postTitle').addEventListener('blur', (e) => {
                    const result = validateTitle(e.target.value);
                    const errorEl = document.getElementById('titleError');
                    if (!result.valid) {
                        errorEl.style.display = 'block';
                        e.target.style.borderColor = '#ef4444';
                    } else {
                        errorEl.style.display = 'none';
                        e.target.style.borderColor = '#334155';
                    }
                });
                
                document.getElementById('postDescription').addEventListener('blur', (e) => {
                    const result = validateDescription(e.target.value);
                    const errorEl = document.getElementById('descriptionError');
                    if (!result.valid) {
                        errorEl.style.display = 'block';
                        e.target.style.borderColor = '#ef4444';
                    } else {
                        errorEl.style.display = 'none';
                        e.target.style.borderColor = '#334155';
                    }
                });
                
                document.getElementById('postBank').addEventListener('blur', (e) => {
                    const result = validateBank(e.target.value);
                    const errorEl = document.getElementById('bankError');
                    if (!result.valid) {
                        errorEl.style.display = 'block';
                        e.target.style.borderColor = '#ef4444';
                    } else {
                        errorEl.style.display = 'none';
                        e.target.style.borderColor = '#334155';
                    }
                });
                
                document.getElementById('postPhone').addEventListener('blur', (e) => {
                    const result = validatePhone(e.target.value);
                    const errorEl = document.getElementById('phoneError');
                    if (!result.valid) {
                        errorEl.style.display = 'block';
                        e.target.style.borderColor = '#ef4444';
                    } else {
                        errorEl.style.display = 'none';
                        e.target.style.borderColor = '#334155';
                    }
                });
                
                document.getElementById('postAmount').addEventListener('blur', (e) => {
                    const result = validateAmount(e.target.value);
                    const errorEl = document.getElementById('amountError');
                    if (!result.valid) {
                        errorEl.style.display = 'block';
                        e.target.style.borderColor = '#ef4444';
                    } else {
                        errorEl.style.display = 'none';
                        e.target.style.borderColor = '#334155';
                    }
                });
                
                // Form submission
                document.getElementById('postCreationForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    
                    // Hide all errors first
                    document.querySelectorAll('[id$="Error"]').forEach(el => {
                        if (el.id !== 'avatarError' && el.id !== 'ageError') {
                            el.style.display = 'none';
                        }
                    });
                    
                    // Validate avatar and age first
                    const verificationData = getFromLocalStorage('verificationData');
                    if (!verificationData) {
                        alert('Не найдены данные верификации. Пожалуйста, заполните форму проверки заново.');
                        return;
                    }

                    // Получаем или создаем контейнер ошибок
                    let formErrors = document.getElementById('formErrors');
                    if (!formErrors) {
                        formErrors = document.createElement('div');
                        formErrors.id = 'formErrors';
                        formErrors.style.cssText = 'margin-bottom: 16px;';
                        const form = document.getElementById('postCreationForm');
                        if (form) {
                            form.insertBefore(formErrors, form.firstChild);
                        }
                    }

                    // Получаем или создаем элементы ошибок
                    let avatarErrorEl = document.getElementById('avatarError');
                    if (!avatarErrorEl) {
                        avatarErrorEl = document.createElement('p');
                        avatarErrorEl.id = 'avatarError';
                        avatarErrorEl.style.cssText = 'color: #ef4444; font-size: 12px; margin-top: 4px; margin-bottom: 8px; display: none;';
                        avatarErrorEl.textContent = '⚠️ Необходимо загрузить фото пользователя в форме верификации';
                        formErrors.appendChild(avatarErrorEl);
                    }

                    let ageErrorEl = document.getElementById('ageError');
                    if (!ageErrorEl) {
                        ageErrorEl = document.createElement('p');
                        ageErrorEl.id = 'ageError';
                        ageErrorEl.style.cssText = 'color: #ef4444; font-size: 12px; margin-top: 4px; margin-bottom: 8px; display: none;';
                        ageErrorEl.textContent = '⚠️ Вам должно быть не менее 18 лет для создания поста';
                        formErrors.appendChild(ageErrorEl);
                    }

                    // Скрываем ошибки
                    avatarErrorEl.style.display = 'none';
                    ageErrorEl.style.display = 'none';

                    let errors = [];

                    // Проверка возраста
                    const birthDateStr = verificationData.birthDate;
                    let ageValid = false;
                    if (birthDateStr) {
                        let birthDate;
                        if (birthDateStr.includes('.')) {
                            const parts = birthDateStr.split('.');
                            birthDate = new Date(parts[2], parts[1] - 1, parts[0]);
                        } else {
                            birthDate = new Date(birthDateStr);
                        }

                        if (!isNaN(birthDate.getTime())) {
                            const today = new Date();
                            let age = today.getFullYear() - birthDate.getFullYear();
                            const m = today.getMonth() - birthDate.getMonth();
                            if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
                                age--;
                            }
                            if (age >= 18) {
                                ageValid = true;
                            }
                        }
                    }
                    if (!ageValid) {
                        errors.push('age');
                        ageErrorEl.style.display = 'block';
                    }

                    // Проверка аватара
                    const userPhoto = verificationData.userPhoto;
                    if (!userPhoto || typeof userPhoto !== 'string' || userPhoto.trim() === '') {
                        errors.push('avatar');
                        avatarErrorEl.style.display = 'block';
                    }

                    // Если есть ошибки — прокрутка и остановка
                    if (errors.length > 0) {
                        formErrors.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        return;
                    }
                    
                    // Validate media
                    const mediaElements = document.getElementById('mediaPreview').querySelectorAll('img, video');
                    const mediaArray = Array.from(mediaElements).map(el => el.src);
                    const mediaError = document.getElementById('mediaError');
                    
                    if (mediaArray.length === 0) {
                        mediaError.style.display = 'block';
                        document.getElementById('mediaUploadArea').style.borderColor = '#ef4444';
                        return;
                    } else {
                        mediaError.style.display = 'none';
                        document.getElementById('mediaUploadArea').style.borderColor = '#334155';
                    }
                    
                    // Validate all fields
                    const title = document.getElementById('postTitle').value;
                    const titleResult = validateTitle(title);
                    if (!titleResult.valid) {
                        document.getElementById('titleError').style.display = 'block';
                        document.getElementById('postTitle').style.borderColor = '#ef4444';
                        return;
                    }
                    
                    const description = document.getElementById('postDescription').value;
                    const descResult = validateDescription(description);
                    if (!descResult.valid) {
                        document.getElementById('descriptionError').style.display = 'block';
                        document.getElementById('postDescription').style.borderColor = '#ef4444';
                        return;
                    }
                    
                    const bank = document.getElementById('postBank').value;
                    const bankResult = validateBank(bank);
                    if (!bankResult.valid) {
                        document.getElementById('bankError').style.display = 'block';
                        document.getElementById('postBank').style.borderColor = '#ef4444';
                        return;
                    }
                    
                    const phone = document.getElementById('postPhone').value;
                    const phoneResult = validatePhone(phone);
                    if (!phoneResult.valid) {
                        document.getElementById('phoneError').style.display = 'block';
                        document.getElementById('postPhone').style.borderColor = '#ef4444';
                        return;
                    }
                    
                    const amount = document.getElementById('postAmount').value;
                    const amountResult = validateAmount(amount);
                    if (!amountResult.valid) {
                        document.getElementById('amountError').style.display = 'block';
                        document.getElementById('postAmount').style.borderColor = '#ef4444';
                        return;
                    }

                    const firstName = verificationData.firstName || 'Пользователь';
                    const lastName = verificationData.lastName || '';
                    const shortLast = lastName ? `${lastName.charAt(0)}.` : '';
                    const displayName = shortLast ? `${firstName} ${shortLast}` : firstName;

                    const userPost = {
                        id: Date.now(),
                        title: document.getElementById('postTitle').value,
                        description: document.getElementById('postDescription').value,
                        amount: parseInt(document.getElementById('postAmount').value),
                        bank: document.getElementById('postBank').value,
                        phone: document.getElementById('postPhone').value,
                        media: mediaArray, // Массив медиа файлов
                        authorName: displayName,
                        authorFull: `${firstName} ${lastName}`.trim(),
                        avatar: verificationData.userPhoto,
                        recipient: displayName,
                        createdAt: new Date().toISOString(),
                        collected: 0,
                        editable: true
                    };
                    
                    saveToLocalStorage('userPost', userPost);
                    modal.remove();
                    
                    // Показываем модальное окно успешного создания поста
                    showPostCreatedSuccess(() => {
                        // Показываем созданный пост
                        document.getElementById('charityInitial').style.display = 'none';
                        document.getElementById('postsList').style.display = 'none';
                        document.getElementById('userPostView').style.display = 'block';
                        displayUserPost();
                        
                        // Показываем вкладки для нуждающегося (только Чаты)
                        showNeedyTabs();
                    });
                });
            }
            
            function displayUserPost() {
                const userPost = getFromLocalStorage('userPost');
                if (!userPost) return;
                
                // Отображаем медиа в галерее
                const mediaGallery = document.getElementById('userPostMediaGallery');
                mediaGallery.innerHTML = '';
                
                if (userPost.media && Array.isArray(userPost.media) && userPost.media.length > 0) {
                    // Если медиа - массив
                    userPost.media.forEach((mediaSrc, index) => {
                        const mediaItem = document.createElement('div');
                        mediaItem.style.cssText = 'width: 100%; height: 400px; position: relative; overflow: hidden;';
                        
                        if (mediaSrc.includes('data:video') || mediaSrc.endsWith('.mp4') || mediaSrc.endsWith('.webm')) {
                            mediaItem.innerHTML = `<video src="${mediaSrc}" style="width: 100%; height: 100%; object-fit: cover;" controls></video>`;
                        } else {
                            mediaItem.innerHTML = `<img src="${mediaSrc}" style="width: 100%; height: 100%; object-fit: cover;" alt="Фото ${index + 1}">`;
                        }
                        
                        mediaGallery.appendChild(mediaItem);
                    });
                } else if (userPost.media) {
                    // Если медиа - строка (старый формат)
                    const mediaItem = document.createElement('div');
                    mediaItem.style.cssText = 'width: 100%; height: 400px; position: relative; overflow: hidden;';
                    
                    if (typeof userPost.media === 'string') {
                        if (userPost.media.includes('data:video') || userPost.media.endsWith('.mp4') || userPost.media.endsWith('.webm')) {
                            mediaItem.innerHTML = `<video src="${userPost.media}" style="width: 100%; height: 100%; object-fit: cover;" controls></video>`;
                        } else {
                            mediaItem.innerHTML = `<img src="${userPost.media}" style="width: 100%; height: 100%; object-fit: cover;" alt="Фото">`;
                        }
                        mediaGallery.appendChild(mediaItem);
                    }
                }
                
                // Отображаем данные поста (только из поста, не из верификации)
                document.getElementById('userPostAvatar').src = userPost.avatar || '/placeholder.svg';
                document.getElementById('userPostAuthor').textContent = userPost.authorName || 'Пользователь';
                document.getElementById('userPostTitle').textContent = userPost.title || '';
                document.getElementById('userPostDescription').textContent = userPost.description || '';
                document.getElementById('userPostRecipient').textContent = userPost.recipient || userPost.authorName || 'Пользователь';
                document.getElementById('userPostBank').textContent = userPost.bank || '';
                document.getElementById('userPostPhone').textContent = userPost.phone || '';
                document.getElementById('userPostCollected').textContent = `Собрано: ${(userPost.collected || 0).toLocaleString('ru-RU')} ₽`;
                document.getElementById('userPostAmount').textContent = (userPost.amount || 0).toLocaleString('ru-RU');
                
                const progress = userPost.amount > 0 ? ((userPost.collected || 0) / userPost.amount) * 100 : 0;
                document.getElementById('userPostProgress').style.width = `${Math.min(progress, 100)}%`;
            }
            
            function checkUserVerificationStatus() {
                const verificationData = getFromLocalStorage('verificationData');
                const userPost = getFromLocalStorage('userPost');
                
                if (verificationData && verificationData.status === 'approved' && userPost) {
                    // Показываем созданный пост при загрузке страницы
                    document.getElementById('charityInitial').style.display = 'none';
                    document.getElementById('postsList').style.display = 'none';
                    document.getElementById('userPostView').style.display = 'block';
                    displayUserPost();
                    return userPost;
                }
                return null;
            }
            
            // Проверяем при загрузке страницы
            checkUserVerificationStatus();

        }); // End of DOMContentLoaded wrapper

        // Ripple effect function
        function createRipple(event, element) {
            const button = element || event.currentTarget;
            
            // Check if element already has position relative
            const computedStyle = window.getComputedStyle(button);
            if (computedStyle.position === 'static') {
                button.style.position = 'relative';
            }
            if (computedStyle.overflow === 'visible') {
                button.style.overflow = 'hidden';
            }
            
            // Remove existing ripples
            const existingRipples = button.getElementsByClassName('ripple');
            Array.from(existingRipples).forEach(ripple => ripple.remove());
            
            const circle = document.createElement('span');
            const diameter = Math.max(button.clientWidth, button.clientHeight);
            const radius = diameter / 2;
            
            const rect = button.getBoundingClientRect();
            circle.style.width = circle.style.height = `${diameter}px`;
            circle.style.left = `${event.clientX - rect.left - radius}px`;
            circle.style.top = `${event.clientY - rect.top - radius}px`;
            circle.classList.add('ripple');
            
            button.appendChild(circle);
            
            // Remove ripple after animation completes
            circle.addEventListener('animationend', () => {
                circle.remove();
            });
            
            // Fallback: remove after 600ms if animationend doesn't fire
            setTimeout(() => {
                if (circle.parentNode) {
                    circle.remove();
                }
            }, 600);
        }

        // Apply ripple effect using event delegation
        document.addEventListener('click', function(e) {
            // Skip if clicking on ripple element itself or its children
            if (e.target.classList.contains('ripple') || e.target.closest('.ripple')) {
                return;
            }
            
            // Use setTimeout to ensure ripple is created after event handlers execute
            setTimeout(() => {
                // Skip if clicking on non-interactive elements (text, icons, etc.)
                if (e.target.tagName === 'SPAN' || e.target.tagName === 'P' || e.target.tagName === 'H1' || 
                    e.target.tagName === 'H2' || e.target.tagName === 'H3' || e.target.tagName === 'H4' ||
                    e.target.tagName === 'SVG' || e.target.tagName === 'PATH' || e.target.tagName === 'LINE' ||
                    e.target.tagName === 'CIRCLE' || e.target.tagName === 'POLYLINE' || e.target.tagName === 'POLYGON' ||
                    e.target.tagName === 'DIV' && (e.target.classList.contains('header') || 
                    e.target.classList.contains('subtitle') || e.target.classList.contains('icon-wrapper') ||
                    e.target.classList.contains('support-container') || e.target.classList.contains('content-section'))) {
                    // Find parent interactive element
                    const parent = e.target.closest('.nav-item, button, .post-card, .chat-item, .support-category, .support-solution, .rule-card, .leaderboard-item');
                    if (parent && !parent.disabled && !parent.classList.contains('ripple')) {
                        // Only apply if parent is a specific interactive element, not a container
                        if (!parent.classList.contains('content-section') && 
                            !parent.classList.contains('support-container') && 
                            !parent.classList.contains('rules-container') && 
                            !parent.classList.contains('rating-container')) {
                            createRipple(e, parent);
                        }
                    }
                    return;
                }
                
                // Find the closest interactive element
                const target = e.target.closest('.nav-item, button, .post-card, .chat-item, .support-category, .support-solution, .rule-card, .leaderboard-item, .upload-button, .submit-button, .support-btn, .chat-send-btn, .support-chat-send-btn');
                
                if (!target || target.disabled) {
                    return;
                }
                
                // Don't apply ripple to containers or content sections
                if (target.classList.contains('content-section') || 
                    target.classList.contains('support-container') || 
                    target.classList.contains('rules-container') || 
                    target.classList.contains('rating-container') ||
                    target.classList.contains('card') ||
                    target.classList.contains('main-content') ||
                    target.classList.contains('support-categories')) {
                    return;
                }
                
                // Apply ripple only to specific interactive elements
                createRipple(e, target);
            }, 0);
        });

    </script>
</body>
</html>